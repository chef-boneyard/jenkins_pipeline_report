---
result: FAILURE
url: http://manhattan.ci.chef.co/job/chefdk-trigger-release/37/
failure_category: code
failure_cause: 'chef_acceptance[top-cookbooks::provision]: acceptance: chefdk-test'
timestamp: 2016-04-12 17:12:08 UTC
duration: 2h45m44s
triggered_by: chef-jenkins
active_duration: 57m43s
retry_delays: 1h47m44s
parameters:
  GIT_REF: v0.13.19
  EXPIRE_CACHE: false
change:
  git_remote: git://github.com/chef/chef-dk.git
  git_commit: 577815f788a384c051fff7bb5c7cc703882f9669
  project: chefdk
  version: 0.13.19
stages:
  chefdk-test:
    result: FAILURE
    failure_category: code
    failure_cause: 'chef_acceptance[top-cookbooks::provision]: acceptance'
    url: http://manhattan.ci.chef.co/job/chefdk-test/98/
    duration: 2h16m38s
    active_duration: 28m53s
    retries: 1
    retry_delay: 1h47m44s
    runs:
      acceptance:
        result: FAILURE
        failure_category: code
        failure_cause: chef_acceptance[top-cookbooks::provision]
        failed_in:
          chef_acceptance:
          - top-cookbooks::provision
          step: CHEF-ACCEPTANCE
        url: http://manhattan.ci.chef.co/job/chefdk-test/architecture=x86_64,platform=acceptance,project=chefdk,role=tester/98/
        duration: 3m31s
        logs:
          consoleText:
            1309: |2
                                >>>>>> ----------------------
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:37 +0000]
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:37 +0000] zlib(finalizer): the stream was freed prematurely.
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:37 +0000]
                      ================================================================================
                      Error executing action `run` on resource 'execute[bundle exec kitchen converge  -c]'
                      ================================================================================

                      Mixlib::ShellOut::ShellCommandFailed
                      ------------------------------------
                      Expected process to exit with [0], but received '10'
                      ---- Begin output of bundle exec kitchen converge  -c ----
                      STDOUT: -----> Starting Kitchen (v1.7.2)
                      -----> Creating <docker-default-ubuntu-1404>...
                             If you are not using an account that qualifies under the AWS
                      free-tier, you may be charged to run these suites. The charge
                      should be minimal, but neither Test Kitchen nor its maintainers
                      are responsible for your incurred costs.

                             Instance <i-54444b93> requested.
                             Polling AWS for existence, attempt 0...
                             Attempting to tag the instance, 0 retries
                             EC2 instance <i-54444b93> created.
                             Waited 0/300s for instance <i-54444b93> to become ready.
                             Waited 5/300s for instance <i-54444b93> to become ready.
                             Waited 10/300s for instance <i-54444b93> to become ready.
                             Waited 15/300s for instance <i-54444b93> to become ready.
                             Waited 20/300s for instance <i-54444b93> to become ready.
                             Waited 25/300s for instance <i-54444b93> to become ready.
                             EC2 instance <i-54444b93> ready.
                             Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                             Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                             Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                             Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                             Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                             [SSH] Established
                             Finished creating <docker-default-ubuntu-1404> (1m16.61s).
                      -----> Converging <docker-default-ubuntu-1404>...
                             Preparing files for transfer
                             Preparing dna.json
                             Resolving cookbook dependencies with Berkshelf 4.3.2...
                             Removing non-cookbook files before transfer
                             Preparing validation.pem
                             Preparing client.rb
                             ubuntu 14.04 x86_64
                             downloading http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb.metadata.json
                             http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb
                               to file /tmp/install.sh.1355/chefdk_0.13.19-1_amd64.deb
                             trying wget...
                             trying curl...
                             /tmp/chef-installer.sh: line 140: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                             grep: /tmp/install.sh.1355/stderr: No such file or directory
                             trying perl...
                             /tmp/chef-installer.sh: line 170: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                             grep: /tmp/install.sh.1355/stderr: No such file or directory
                             trying python...
                             /tmp/chef-installer.sh: line 191: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                             grep: /tmp/install.sh.1355/stderr: No such file or directory
                             Unable to retrieve a valid package!
                             Version: latest

                             Please file a Bug Report at https://github.com/chef/omnitruck/issues/new
                             Alternatively, feel free to open a Support Ticket at https://www.chef.io/support/tickets
                             More Chef support resources can be
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:37 +0000]  found at https://www.chef.io/support
            2183: |2
                      sudo -E /tmp/chef-installer.sh]
                      >>>>>> ----------------------
                      zlib(finalizer): the stream was freed prematurely.
                      ---- End output of bundle exec kitchen converge  -c ----
                      Ran bundle exec kitchen converge  -c returned 10
            2230: |2

              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:37 +0000]
                    ================================================================================
                    Error executing action `run` on resource 'cookbook_kitchen[converge docker]'
                    ================================================================================

                    Mixlib::ShellOut::ShellCommandFailed
                    ------------------------------------
                    execute[bundle exec kitchen converge  -c] (/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/cookbooks/kitchen_acceptance/libraries/kitchen.rb line 36) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '10'
                    ---- Begin output of bundle exec kitchen converge  -c ----
                    STDOUT: -----> Starting Kitchen (v1.7.2)
                    -----> Creating <docker-default-ubuntu-1404>...
                           If you are not using an account that qualifies under the AWS
                    free-tier, you may be charged to run these suites. The charge
                    should be minimal, but neither Test Kitchen nor its maintainers
                    are responsible for your incurred costs.

                           Instance <i-54444b93> requested.
                           Polling AWS for existence, attempt 0...
                           Attempting to tag the instance, 0 retries
                           EC2 instance <i-54444b93> created.
                           Waited 0/300s for instance <i-54444b93> to become ready.
                           Waited 5/300s for instance <i-54444b93> to become ready.
                           Waited 10/300s for instance <i-54444b93> to become ready.
                           Waited 15/300s for instance <i-54444b93> to become ready.
                           Waited 20/300s for instance <i-54444b93> to become ready.
                           Waited 25/300s for instance <i-54444b93> to become ready.
                           EC2 instance <i-54444b93> ready.
                           Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                           Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                           Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                           Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                           Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                           [SSH] Established
                           Finished creating <docker-default-ubuntu-1404> (1m16.61s).
                    -----> Converging <docker-default-ubuntu-1404>...
                           Preparing files for transfer
                           Preparing dna.json
                           Resolving cookbook dependencies with Berkshelf 4.3.2...
                           Removing non-cookbook files before transfer
                           Preparing validation.pem
                           Preparing client.rb
                           ubuntu 14.04 x86_64
                           downloading http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb.metadata.json
                           http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb
                             to file /tmp/install.sh.1355/chefdk_0.13.19-1_amd64.deb
                           trying wget...
                           trying curl...
                           /tmp/chef-installer.sh: line 140: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                           grep: /tmp/install.sh.1355/stderr: No such file or directory
                           trying perl...
                           /tmp/chef-installer.sh: line 170: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                           grep: /tmp/install.sh.1355/stderr: No such file or directory
                           trying python...
                           /tmp/chef-installer.sh: line 191: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                           grep: /tmp/install.sh.1355/stderr: No such file or directory
                           Unable to retrieve a valid package!
                           Version: latest

                           Please file a Bug Report at https://github.com/ch
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:37 +0000] ef/omnitruck/issues/new
                           Alternatively, feel free to open a Support Ticket at https://www.chef.io/support/tickets
            3094: |2
                    sudo -E /tmp/chef-installer.sh]
                    >>>>>> ----------------------
                    zlib(finalizer): the stream was freed prematurely.
                    ---- End output of bundle exec kitchen converge  -c ----
                    Ran bundle exec kitchen converge  -c returned 10
            3136: |2


                  ================================================================================
                  Error executing action `run` on resource 'top_cookbooks[converge]'
                  ================================================================================

                  Mixlib::ShellOut::ShellCommandFailed
                  ------------------------------------
                  cookbook_kitchen[converge docker] (/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/cookbooks/acceptance-cookbook/libraries/top_cookbooks.rb line 7) had an error: Mixlib::ShellOut::ShellCommandFailed: execute[bundle exec kitchen converge  -
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:37 +0000] c] (/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/cookbooks/kitchen_acceptance/libraries/kitchen.rb line 36) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '10'
                  ---- Begin output of bundle exec kitchen converge  -c ----
            4005: |2
                  sudo -E /tmp/chef-installer.sh]
                  >>>>>> ----------------------
                  zlib(finalizer): the stream was freed prematurely.
                  ---- End output of bundle exec kitchen converge  -c ----
                  Ran bundle exec kitchen converge  -c returned 10
            4046: |
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:38 +0000] Running handlers:
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:38 +0000]
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:38 +0000] [2016-04-12T19:31:38+00:00] ERROR: Running exception handlers
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:38 +0000] Running handlers complete
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:38 +0000] [2016-04-12T19:31:38+00:00] ERROR: Exception handlers complete
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:38 +0000] Chef Client failed. 2 resources updated in 01 minutes 40 seconds
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:38 +0000]
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:38 +0000] [2016-04-12T19:31:38+00:00] ERROR: Failed to post audit report to server. Saving report to /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/failed-audit-data.json
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:38 +0000] [2016-04-12T19:31:38+00:00] FATAL: Stacktrace dumped to /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/chef-stacktrace.out
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:38 +0000] [2016-04-12T19:31:38+00:00] FATAL: Please provide the contents of the stacktrace.out file if you file a bug report
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:38 +0000] [2016-04-12T19:31:38+00:00] ERROR: Found 1 errors, they are stored in the backtrace
              TOP-COOKBOOKS::PROVISION::[2016-04-12 19:31:39 +0000] [2016-04-12T19:31:39+00:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process exited unsuccessfully (exit code 1)
              CHEF-ACCEPTANCE::[2016-04-12 19:31:39 +0000] Encountered an error running the recipe provision: Expected process to exit with [0], but received '1'
              ---- Begin output of chef-client -z -c /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/config.rb --force-formatter -j /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/dna.json -o acceptance-cookbook::provision --no-color ----
            4925: |2
                                sudo -E /tmp/chef-installer.sh]
                                >>>>>> ----------------------
                                zlib(finalizer): the stream was freed prematurely.

                      ================================================================================
                      Error executing action `run` on resource 'execute[bundle exec kitchen converge  -c]'
                      ================================================================================

                      Mixlib::ShellOut::ShellCommandFailed
                      ------------------------------------
                      Expected process to exit with [0], but received '10'
                      ---- Begin output of bundle exec kitchen converge  -c ----
                      STDOUT: -----> Starting Kitchen (v1.7.2)
                      -----> Creating <docker-default-ubuntu-1404>...
                             If you are not using an account that qualifies under the AWS
                      free-tier, you may be charged to run these suites. The charge
                      should be minimal, but neither Test Kitchen nor its maintainers
                      are responsible for your incurred costs.

                             Instance <i-54444b93> requested.
                             Polling AWS for existence, attempt 0...
                             Attempting to tag the instance, 0 retries
                             EC2 instance <i-54444b93> created.
                             Waited 0/300s for instance <i-54444b93> to become ready.
                             Waited 5/300s for instance <i-54444b93> to become ready.
                             Waited 10/300s for instance <i-54444b93> to become ready.
                             Waited 15/300s for instance <i-54444b93> to become ready.
                             Waited 20/300s for instance <i-54444b93> to become ready.
                             Waited 25/300s for instance <i-54444b93> to become ready.
                             EC2 instance <i-54444b93> ready.
                             Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                             Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                             Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                             Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                             Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                             [SSH] Established
                             Finished creating <docker-default-ubuntu-1404> (1m16.61s).
                      -----> Converging <docker-default-ubuntu-1404>...
                             Preparing files for transfer
                             Preparing dna.json
                             Resolving cookbook dependencies with Berkshelf 4.3.2...
                             Removing non-cookbook files before transfer
                             Preparing validation.pem
                             Preparing client.rb
                             ubuntu 14.04 x86_64
                             downloading http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb.metadata.json
                             http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb
                               to file /tmp/install.sh.1355/chefdk_0.13.19-1_amd64.deb
                             trying wget...
                             trying curl...
                             /tmp/chef-installer.sh: line 140: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                             grep: /tmp/install.sh.1355/stderr: No such file or directory
                             trying perl...
                             /tmp/chef-installer.sh: line 170: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                             grep: /tmp/install.sh.1355/stderr: No such file or directory
                             trying python...
                             /tmp/chef-installer.sh: line 191: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                             grep: /tmp/install.sh.1355/stderr: No such file or directory
                             Unable to retrieve a valid package!
                             Version: latest

                             Please file a Bug Report at https://github.com/chef/omnitruck/issues/new
                             Alternatively, feel free to open a Support Ticket at https://www.chef.io/support/tickets
                             More Chef support resources can be found at https://www.chef.io/support

                             Please include as many details about the problem as possible i.e., how to reproduce
                             the problem (if possible), type of the Operating System and its version, etc.,
                             and any other relevant details that might help us with troubleshooting.

                             Metadata URL:
                             Download URL: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb.metadata.json
                             http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb
                             \nDEBUG OUTPUT FOLLOWS:\n\nSTDERR from wget:\n\nhttp://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory\n
                      STDERR: >>>>>> Converge failed on instance <docker-default-ubuntu-1404>.
                      >>>>>> Please see .kitchen/logs/docker-default-ubuntu-1404.log for more details
                      >>>>>> ------Exception-------
                      >>>>>> Class: Kitchen::ActionFailed
                      >>>>>> Message: SSH exited (1) for command: [sudo -E cat > /tmp/chef-installer.sh <<"EOL"
                      #!/bin/bash
                      #!/bin/sh
                      # WARNING: REQUIRES /bin/sh
                      #
                      # - must run on /bin/sh on solaris 9
                      # - must run on /bin/sh on AIX 6.x
                      #
                      # Copyright:: Copyright (c) 2010-2015 Chef Software, Inc.
                      # License:: Apache License, Version 2.0
                      #
                      # Licensed under the Apache License, Version 2.0 (the "License");
                      # you may not use this file except in compliance with the License.
                      # You may obtain a copy of the License at
                      #
                      #     http://www.apache.org/licenses/LICENSE-2.0
                      #
                      # Unless required by applicable law or agreed to in writing, software
                      # distributed under the License is distributed on an "AS IS" BASIS,
                      # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                      # See the License for the specific language governing permissions and
                      # limitations under the License.
                      #

                      # helpers.sh
                      ############
                      # This section has some helper functions to make life easier.
                      #
                      # Outputs:
                      # $tmp_dir: secure-ish temp directory that can be used during installation.
                      ############

                      # Check whether a command exists - returns 0 if it does, 1 if it does not
                      exists() {
                        if command -v $1 >/dev/null 2>&1
                        then
                          return 0
                        else
                          return 1
                        fi
                      }

                      # Output the instructions to report bug about this script
                      report_bug() {
                        echo "Version: $version"
                        echo ""
                        echo "Please file a Bug Report at https://github.com/chef/omnitruck/issues/new"
                        echo "Alternatively, feel free to open a Support Ticket at https://www.chef.io/support/tickets"
                        echo "More Chef support resources can be found at https://www.chef.io/support"
                        echo ""
                        echo "Please include as many details about the problem as possible i.e., how to reproduce"
                        echo "the problem (if possible), type of the Operating System and its version, etc.,"
                        echo "and any other relevant details that might help us with troubleshooting."
                        echo ""
                      }

                      checksum_mismatch() {
                        echo "Package checksum mismatch!"
                        report_bug
                        exit 1
                      }

                      unable_to_retrieve_package() {
                        echo "Unable to retrieve a valid package!"
                        report_bug
                        echo "Metadata URL: $metadata_url"
                        if test "x$download_url" != "x"; then
                          echo "Download URL: $download_url"
                        fi
                        if test "x$stderr_results" != "x"; then
                          echo "\nDEBUG OUTPUT FOLLOWS:\n$stderr_results"
                        fi
                        exit 1
                      }

                      http_404_error() {
                        echo "Omnitruck artifact does not exist for version $version on platform $platform"
                        echo ""
                        echo "Either this means:"
                        echo "   - We do not support $platform"
                        echo "   - We do not have an artifact for $version"
                        echo ""
                        echo "This is often the latter case due to running a prerelease or RC version of chef"
                        echo "or a gem version which was only pushed to rubygems and not omnitruck."
                        echo ""
                        echo "You may be able to set your knife[:bootstrap_version] to the most recent stable"
                        echo "release of Chef to fix this problem (or the most recent stable major version number)."
                        echo ""
                        echo "In order to test the version parameter, adventurous users may take the Metadata URL"
                        echo "below and modify the '&v=<number>' parameter until you successfully get a URL that"
                        echo "does not 404 (e.g. via curl or wget).  You should be able to use '&v=11' or '&v=12'"
                        echo "succesfully."
                        echo ""
                        echo "If you cannot fix this problem by setting the bootstrap_version, it probably means"
                        echo "that $platform is not supported."
                        echo ""
                        # deliberately do not call report_bug to suppress bug report noise.
                        echo "Metadata URL: $metadata_url"
                        if test "x$download_url" != "x"; then
                          echo "Download URL: $download_url"
                        fi
                        if test "x$stderr_results" != "x"; then
                          echo "\nDEBUG OUTPUT FOLLOWS:\n$stderr_results"
                        fi
                        exit 1
                      }

                      capture_tmp_stderr() {
                        # spool up /tmp/stderr from all the commands we called
                        if test -f "$tmp_dir/stderr"; then
                          output=`cat $tmp_dir/stderr`
                          stderr_results="${stderr_results}\nSTDERR from $1:\n\n$output\n"
                          rm $tmp_dir/stderr
                        fi
                      }

                      # do_wget URL FILENAME
                      do_wget() {
                        echo "trying wget..."
                        wget -O "$2" "$1" 2>$tmp_dir/stderr
                        rc=$?
                        # check for 404
                        grep "ERROR 404" $tmp_dir/stderr 2>&1 >/dev/null
                        if test $? -eq 0; then
                          echo "ERROR 404"
                          http_404_error
                        fi

                        # check for bad return status or empty output
                        if test $rc -ne 0 || test ! -s "$2"; then
                          capture_tmp_stderr "wget"
                          return 1
                        fi

                        return 0
                      }

                      # do_curl URL FILENAME
                      do_curl() {
                        echo "trying curl..."
                        curl --retry 5 -sL -D $tmp_dir/stderr "$1" > "$2"
                        rc=$?
                        # check for 404
                        grep "404 Not Found" $tmp_dir/stderr 2>&1 >/dev/null
                        if test $? -eq 0; then
                          echo "ERROR 404"
                          http_404_error
                        fi

                        # check for bad return status or empty output
                        if test $rc -ne 0 || test ! -s "$2"; then
                          capture_tmp_stderr "curl"
                          return 1
                        fi

                        return 0
                      }

                      # do_fetch URL FILENAME
                      do_fetch() {
                        echo "trying fetch..."
                        fetch -o "$2" "$1" 2>$tmp_dir/stderr
                        # check for bad return status
                        test $? -ne 0 && return 1
                        return 0
                      }

                      # do_perl URL FILENAME
                      do_perl() {
                        echo "trying perl..."
                        perl -e 'use LWP::Simple; getprint($ARGV[0]);' "$1" > "$2" 2>$tmp_dir/stderr
                        rc=$?
                        # check for 404
                        grep "404 Not Found" $tmp_dir/stderr 2>&1 >/dev/null
                        if test $? -eq 0; then
                          echo "ERROR 404"
                          http_404_error
                        fi

                        # check for bad return status or empty output
                        if test $rc -ne 0 || test ! -s "$2"; then
                          capture_tmp_stderr "perl"
                          return 1
                        fi

                        return 0
                      }

                      # do_python URL FILENAME
                      do_python() {
                        echo "trying python..."
                        python -c "import sys,urllib2 ; sys.stdout.write(urllib2.urlopen(sys.argv[1]).read())" "$1" > "$2" 2>$tmp_dir/stderr
                        rc=$?
                        # check for 404
                        grep "HTTP Error 404" $tmp_dir/stderr 2>&1 >/dev/null
                        if test $? -eq 0; then
                          echo "ERROR 404"
                          http_404_error
                        fi

                        # check for bad return status or empty output
                        if test $rc -ne 0 || test ! -s "$2"; then
                          capture_tmp_stderr "python"
                          return 1
                        fi
                        return 0
                      }

                      # returns 0 if checksums match
                      do_checksum() {
                        if exists sha256sum; then
                          echo "Comparing checksum with sha256sum..."
                          checksum=`sha256sum $1 | awk '{ print $1 }'`
                          return `test "x$checksum" = "x$2"`
                        elif exists shasum; then
                          echo "Comparing checksum with shasum..."
                          checksum=`shasum -a 256 $1 | awk '{ print $1 }'`
                          return `test "x$checksum" = "x$2"`
                        else
                          echo "WARNING: could not find a valid checksum program, pre-install shasum or sha256sum in your O/S image to get valdation..."
                          return 0
                        fi
                      }

                      # do_download URL FILENAME
                      do_download() {
                        echo "downloading $1"
                        echo "  to file $2"

                        url=`echo $1`
                        if test "x$platform" = "xsolaris2"; then
                          if test "x$platform_version" = "x5.9" -o "x$platform_version" = "x5.10"; then
                            # solaris 9 lacks openssl, solaris 10 lacks recent enough credentials - your base O/S is completely insecure, please upgrade
                            url=`echo $url | sed -e 's/https/http/'`
                          fi
                        fi

                        # we try all of these until we get success.
                        # perl, in particular may be present but LWP::Simple may not be installed

                        if exists wget; then
                          do_wget $url $2 && return 0
                        fi

                        if exists curl; then
                          do_curl $url $2 && return 0
                        fi

                        if exists fetch; then
                          do_fetch $url $2 && return 0
                        fi

                        if exists perl; then
                          do_perl $url $2 && return 0
                        fi

                        if exists python; then
                          do_python $url $2 && return 0
                        fi

                        unable_to_retrieve_package
                      }

                      # install_file TYPE FILENAME
                      # TYPE is "rpm", "deb", "solaris", "sh", etc.
                      install_file() {
                        echo "Installing $project $version"
                        case "$1" in
                          "rpm")
                            if test "x$platform" = "xnexus" || test "x$platform" = "xios_xr"; then
                              echo "installing with yum..."
                              yum install -yv "$2"
                            else
                              echo "installing with rpm..."
                              rpm -Uvh --oldpackage --replacepkgs "$2"
                            fi
                            ;;
                          "deb")
                            echo "installing with dpkg..."
                            dpkg -i "$2"
                            ;;
                          "bff")
                            echo "installing with installp..."
                            installp -aXYgd "$2" all
                            ;;
                          "solaris")
                            echo "installing with pkgadd..."
                            echo "conflict=nocheck" > $tmp_dir/nocheck
                            echo "action=nocheck" >> $tmp_dir/nocheck
                            echo "mail=" >> $tmp_dir/nocheck
                            pkgrm -a $tmp_dir/nocheck -n $project >/dev/null 2>&1 || true
                            pkgadd -G -n -d "$2" -a $tmp_dir/nocheck $project
                            ;;
                          "pkg")
                            echo "installing with installer..."
                            cd / && /usr/sbin/installer -pkg "$2" -target /
                            ;;
                          "dmg")
                            echo "installing dmg file..."
                            hdiutil detach "/Volumes/chef_software" >/dev/null 2>&1 || true
                            hdiutil attach "$2" -mountpoint "/Volumes/chef_software"
                            cd / && /usr/sbin/installer -pkg `find "/Volumes/chef_software" -name \*.pkg` -target /
                            hdiutil detach "/Volumes/chef_software"
                            ;;
                          "sh" )
                            echo "installing with sh..."
                            sh "$2"
                            ;;
                          *)
                            echo "Unknown filetype: $1"
                            report_bug
                            exit 1
                            ;;
                        esac
                        if test $? -ne 0; then
                          echo "Installation failed"
                          report_bug
                          exit 1
                        fi
                      }

                      if test "x$TMPDIR" = "x"; then
                        tmp="/tmp"
                      else
                        tmp=$TMPDIR
                      fi
                      # secure-ish temp dir creation without having mktemp available (DDoS-able but not expliotable)
                      tmp_dir="$tmp/install.sh.$$"
                      (umask 077 && mkdir $tmp_dir) || exit 1

                      ############
                      # end of helpers.sh
                      ############


                      project=chefdk
                      version=latest
                      channel=unstable


                      # platform_detection.sh
                      ############
                      # This section makes platform detection compatible with omnitruck on the system
                      #   it runs.
                      #
                      # Outputs:
                      # $platform: Name of the platform.
                      # $platform_version: Version of the platform.
                      # $machine: System's architecture.
                      ############

                      #
                      # Platform and Platform Version detection
                      #
                      # NOTE: This should now match ohai platform and platform_version matching.
                      # do not invented new platform and platform_version schemas, just make this behave
                      # like what ohai returns as platform and platform_version for the server.
                      #
                      # ALSO NOTE: Do not mangle platform or platform_version here.  It is less error
                      # prone and more future-proof to do that in the server, and then all omnitruck clients
                      # will 'inherit' the changes (install.sh is not the only client of the omnitruck
                      # endpoint out there).
                      #

                      machine=`uname -m`
                      os=`uname -s`

                      if test -f "/etc/lsb-release" && grep -q DISTRIB_ID /etc/lsb-release && ! grep -q wrlinux /etc/lsb-release; then
                        platform=`grep DISTRIB_ID /etc/lsb-release | cut -d "=" -f 2 | tr '[A-Z]' '[a-z]'`
                        platform_version=`grep DISTRIB_RELEASE /etc/lsb-release | cut -d "=" -f 2`
                      elif test -f "/etc/debian_version"; then
                        platform="debian"
                        platform_version=`cat /etc/debian_version`
                      elif test -f "/etc/redhat-release"; then
                        platform=`sed 's/^\(.\+\) release.*/\1/' /etc/redhat-release | tr '[A-Z]' '[a-z]'`
                        platform_version=`sed 's/^.\+ release \([.0-9]\+\).*/\1/' /etc/redhat-release`

                        # If /etc/redhat-release exists, we act like RHEL by default
                        if test "$platform" = "fedora"; then
                          # FIXME: stop remapping fedora to el
                          # FIXME: remove client side platform_version mangling and hard coded yolo
                          # Change platform version for use below.
                          platform_version="6.0"
                        fi

                        if test "$platform" = "xenserver"; then
                          # Current XenServer 6.2 is based on CentOS 5, platform is not reset to "el" server should hanlde response
                          platform="xenserver"
                        else
                          # FIXME: use "redhat"
                          platform="el"
                        fi

                      elif test -f "/etc/system-release"; then
                        platform=`sed 's/^\(.\+\) release.\+/\1/' /etc/system-release | tr '[A-Z]' '[a-z]'`
                        platform_version=`sed 's/^.\+ release \([.0-9]\+\).*/\1/' /etc/system-release | tr '[A-Z]' '[a-z]'`
                        # amazon is built off of fedora, so act like RHEL
                        if test "$platform" = "amazon linux ami"; then
                          # FIXME: remove client side platform_version mangling and hard coded yolo, and remapping to deprecated "el"
                          platform="el"
                          platform_version="6.0"
                        fi
                      # Apple OS X
                      elif test -f "/usr/bin/sw_vers"; then
                        platform="mac_os_x"
                        # Matching the tab-space with sed is error-prone
                        platform_version=`sw_vers | awk '/^ProductVersion:/ { print $2 }' | cut -d. -f1,2`

                        # x86_64 Apple hardware often runs 32-bit kernels (see OHAI-63)
                        x86_64=`sysctl -n hw.optional.x86_64`
                        if test $x86_64 -eq 1; then
                          machine="x86_64"
                        fi
                      elif test -f "/etc/release"; then
                        machine=`/usr/bin/uname -p`
                        if grep -q SmartOS /etc/release; then
                          platform="smartos"
                          platform_version=`grep ^Image /etc/product | awk '{ print $3 }'`
                        else
                          platform="solaris2"
                          platform_version=`/usr/bin/uname -r`
                        fi
                      elif test -f "/etc/SuSE-release"; then
                        if grep -q 'Enterprise' /etc/SuSE-release;
                        then
                            platform="sles"
                            platform_version=`awk '/^VERSION/ {V = $3}; /^PATCHLEVEL/ {P = $3}; END {print V "." P}' /etc/SuSE-release`
                        else
                            platform="suse"
                            platform_version=`awk '/^VERSION =/ { print $3 }' /etc/SuSE-release`
                        fi
                      elif test "x$os" = "xFreeBSD"; then
                        platform="freebsd"
                        platform_version=`uname -r | sed 's/-.*//'`
                      elif test "x$os" = "xAIX"; then
                        platform="aix"
                        platform_version="`uname -v`.`uname -r`"
                        machine="powerpc"
                      elif test -f "/etc/os-release"; then
                        . /etc/os-release
                        if test "x$CISCO_RELEASE_INFO" != "x"; then
                          . $CISCO_RELEASE_INFO
                        fi

                        platform=$ID
                        platform_version=$VERSION
                      fi

                      if test "x$platform" = "x"; then
                        echo "Unable to determine platform version!"
                        report_bug
                        exit 1
                      fi

                      #
                      # NOTE: platform manging in the install.sh is DEPRECATED
                      #
                      # - install.sh should be true to ohai and should not remap
                      #   platform or platform versions.
                      #
                      # - remapping platform and mangling platform version numbers is
                      #   now the complete responsibility of the server-side endpoints
                      #

                      major_version=`echo $platform_version | cut -d. -f1`
                      case $platform in
                        # FIXME: should remove this case statement completely
                        "el")
                          # FIXME:  "el" is deprecated, should use "redhat"
                          platform_version=$major_version
                          ;;
                        "debian")
                          # FIXME: remove client-side yolo here
                          case $major_version in
                            "5") platform_version="6";;  # FIXME: need to port this "reverse-yolo" into platform.rb
                            "6") platform_version="6";;
                            "7") platform_version="6";;
                          esac
                          ;;
                        "freebsd")
                          platform_version=$major_version
                          ;;
                        "sles")
                          platform_version=$major_version
                          ;;
                        "suse")
                          platform_version=$major_version
                          ;;
                      esac

                      if test "x$platform_version" = "x"; then
                        echo "Unable to determine platform version!"
                        report_bug
                        exit 1
                      fi

                      if test "x$platform" = "xsolaris2"; then
                        # hack up the path on Solaris to find wget, pkgadd
                        PATH=/usr/sfw/bin:/usr/sbin:$PATH
                        export PATH
                      fi

                      echo "$platform $platform_version $machine"

                      ############
                      # end of platform_detection.sh
                      ############


                      # artifactory_urls.sh
                      ############
                      # This section sets up the information for a build to be installed from artifactory
                      #  then uses $platform, $platform_version and $machine to select the correct
                      #  version.
                      #
                      # Inputs:
                      # $platform:
                      # $platform_version:
                      # $machine:
                      #
                      # Outputs:
                      # $download_url:
                      # $sha256:
                      ############


                        artifact_info_dir="$tmp_dir/artifact_info/ubuntu/14.04/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 " >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.9/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.9/chefdk-0.13.19-1.dmg.metadata.json" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 " >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/debian/8/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/8/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 " >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/windows/2012r2/i386"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2012r2/chefdk-0.13.19-1-x86.msi" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 e82aaeb0ccefd32ae049e8b32045cc6d2acce75f7e4ae68e6e96bf198cb937b7" >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.11/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.11/chefdk-0.13.19-1.dmg.metadata.json" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 " >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/debian/6/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/6/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 bb5d254b05d1a536f58ef69e64e581dc113bdb32275c6104553a1782182c2cdb" >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/windows/2008r2/i386"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2008r2/chefdk-0.13.19-1-x86.msi.metadata.json" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 " >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/debian/6/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/6/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 " >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.9/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.9/chefdk-0.13.19-1.dmg" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 dfd9d05caab653a92717263fef698b83e14046f2d92cd627fd3725f10009062b" >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/windows/2012r2/i386"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2012r2/chefdk-0.13.19-1-x86.msi.metadata.json" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 " >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/windows/2012/i386"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2012/chefdk-0.13.19-1-x86.msi" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 e82aaeb0ccefd32ae049e8b32045cc6d2acce75f7e4ae68e6e96bf198cb937b7" >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/windows/2008r2/i386"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2008r2/chefdk-0.13.19-1-x86.msi" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 e82aaeb0ccefd32ae049e8b32045cc6d2acce75f7e4ae68e6e96bf198cb937b7" >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/debian/7/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/7/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 bb5d254b05d1a536f58ef69e64e581dc113bdb32275c6104553a1782182c2cdb" >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/el/7/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/el/7/chefdk-0.13.19-1.el7.x86_64.rpm" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 95cedf524c58cdb37421867aa6133a9774080136b5f35ea68d2822b6db9fdbfc" >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/windows/2012/i386"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2012/chefdk-0.13.19-1-x86.msi.metadata.json" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 " >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/debian/7/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/7/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 " >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/ubuntu/12.04/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/12.04/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 " >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/debian/8/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/8/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 bb5d254b05d1a536f58ef69e64e581dc113bdb32275c6104553a1782182c2cdb" >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/el/6/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/el/6/chefdk-0.13.19-1.el6.x86_64.rpm.metadata.json" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 " >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/ubuntu/12.04/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/12.04/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 530bca33b6b06f29b96056f79d024a8c58f9dee92e85f53bf5aa567b4f94a0f8" >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/el/6/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/el/6/chefdk-0.13.19-1.el6.x86_64.rpm" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 2aa10bc3f4948ea3788d8774a653ef048364841bb38b70f3eda6c8e64b27d152" >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/ubuntu/14.04/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 530bca33b6b06f29b96056f79d024a8c58f9dee92e85f53bf5aa567b4f94a0f8" >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.10/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.10/chefdk-0.13.19-1.dmg" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 dfd9d05caab653a92717263fef698b83e14046f2d92cd627fd3725f10009062b" >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/el/7/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/el/7/chefdk-0.13.19-1.el7.x86_64.rpm.metadata.json" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 " >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.11/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.11/chefdk-0.13.19-1.dmg" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 dfd9d05caab653a92717263fef698b83e14046f2d92cd627fd3725f10009062b" >> "$artifact_info_dir/artifact_info"

                        artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.10/x86_64"
                        mkdir -p $artifact_info_dir
                        touch "$artifact_info_dir/artifact_info"
                        echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.10/chefdk-0.13.19-1.dmg.metadata.json" >> "$artifact_info_dir/artifact_info"
                        echo "sha256 " >> "$artifact_info_dir/artifact_info"


                      artifact_info_for_platform="$tmp_dir/artifact_info/$platform/$platform_version/$machine/artifact_info"

                      download_url=`awk '$1 == "url" { print $2 }' "$artifact_info_for_platform"`
                      sha256=`awk '$1 == "sha256" { print $2 }' "$artifact_info_for_platform"`


                      # fetch_package.sh
                      ############
                      # This section fetchs a package from $download_url and verifies its metadata.
                      #
                      # Inputs:
                      # $download_url:
                      # $tmp_dir:
                      # Optional Inputs:
                      # $cmdline_filename: Name of the package downloaded on local disk.
                      # $cmdline_dl_dir: Name of the directory downloaded package will be saved to on local disk.
                      #
                      # Outputs:
                      # $download_filename: Name of the downloaded file on local disk.
                      # $filetype: Type of the file downloaded.
                      ############

                      filename=`echo $download_url | sed -e 's/^.*\///'`
                      filetype=`echo $filename | sed -e 's/^.*\.//'`

                      # use either $tmp_dir, the provided directory (-d) or the provided filename (-f)
                      if test "x$cmdline_filename" != "x"; then
                        download_filename="$cmdline_filename"
                      elif test "x$cmdline_dl_dir" != "x"; then
                        download_filename="$cmdline_dl_dir/$filename"
                      else
                        download_filename="$tmp_dir/$filename"
                      fi

                      # ensure the parent directory where to download the installer always exists
                      download_dir=`dirname $download_filename`
                      (umask 077 && mkdir -p $download_dir) || exit 1

                      # check if we have that file locally available and if so verify the checksum
                      cached_file_available="false"
                      if test -f $download_filename; then
                        echo "$download_filename already exists, verifiying checksum..."
                        if do_checksum "$download_filename" "$sha256"; then
                          echo "checksum compare succeeded, using existing file!"
                          cached_file_available="true"
                        else
                          echo "checksum mismatch, downloading latest version of the file"
                        fi
                      fi

                      # download if no local version of the file available
                      if test "x$cached_file_available" != "xtrue"; then
                        do_download "$download_url"  "$download_filename"
                        do_checksum "$download_filename" "$sha256" || checksum_mismatch
                      fi

                      ############
                      # end of fetch_package.sh
                      ############


                      # install_package.sh
                      ############
                      # Installs a package and removed the temp directory.
                      #
                      # Inputs:
                      # $download_filename: Name of the file to be installed.
                      # $filetype: Type of the file to be installed.
                      # $version: The version requested. Used only for warning user if not set.
                      ############

                      if test "x$version" = "x"; then
                        echo
                        echo "WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING"
                        echo
                        echo "You are installing an omnibus package without a version pin.  If you are installing"
                        echo "on production servers via an automated process this is DANGEROUS and you will"
                        echo "be upgraded without warning on new releases, even to new major releases."
                        echo "Letting the version float is only appropriate in desktop, test, development or"
                        echo "CI/CD environments."
                        echo
                        echo "WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING"
                        echo
                      fi

                      install_file $filetype "$download_filename"

                      if test "x$tmp_dir" != "x"; then
                        rm -r "$tmp_dir"
                      fi

                      ############
                      # end of install_package.sh
                      ############

                      EOL
                      chmod +x /tmp/chef-installer.sh
                      sudo -E /tmp/chef-installer.sh]
                      >>>>>> ----------------------
                      zlib(finalizer): the stream was freed prematurely.
                      ---- End output of bundle exec kitchen converge  -c ----
                      Ran bundle exec kitchen converge  -c returned 10

                      Resource Declaration:
                      ---------------------
                      # In /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/cookbooks/kitchen_acceptance/libraries/kitchen.rb

                       36:       execute "bundle exec kitchen #{command}#{instances ? " #{instances}" : ""}#{kitchen_options ? " #{kitchen_options}" : ""}" do
                       37:         cwd kitchen_dir
                       38:         env({
                       39:           "KITCHEN_DRIVER" => driver,
                       40:           "KITCHEN_INSTANCES" => instances,
                       41:           "KITCHEN_LOCAL_YAML" => ::File.expand_path("../../.kitchen.#{driver}.yml", __FILE__),
                       42:           "KITCHEN_CHEF_PRODUCT" => chef_product,
                       43:           "KITCHEN_CHEF_CHANNEL" => chef_channel,
                       44:           "KITCHEN_CHEF_VERSION" => chef_version,
                       45:           "ARTIFACTORY_USERNAME" => artifactory_username,
                       46:           "ARTIFACTORY_PASSWORD" => artifactory_password
                       47:         }.merge(new_resource.env))
                       48:       end
                       49:     end

                      Compiled Resource:
                      ------------------
                      # Declared in /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/cookbooks/kitchen_acceptance/libraries/kitchen.rb:36:in `block in <class:Kitchen>'

                      execute("bundle exec kitchen converge  -c") do
                        action [:run]
                        retries 0
                        retry_delay 2
                        default_guard_interpreter :execute
                        command "bundle exec kitchen converge  -c"
                        backup 5
                        cwd "/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/test_run/docker/"
                        environment {"KITCHEN_DRIVER"=>"ec2", "KITCHEN_INSTANCES"=>"", "KITCHEN_LOCAL_YAML"=>"/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/cookbooks/kitchen_acceptance/.kitchen.ec2.yml", "KITCHEN_CHEF_PRODUCT"=>"chefdk", "KITCHEN_CHEF_CHANNEL"=>"unstable", "KITCHEN_CHEF_VERSION"=>"latest", "ARTIFACTORY_USERNAME"=>"chef-web-downloads", "ARTIFACTORY_PASSWORD"=>"fWPxYSB69EiuSpl8*3Dr^kGwf#hxUE6cmjeZRB%H!Cruit7qiKp%toH3nXKStQUg", "BUNDLE_GEMFILE"=>"/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/Gemfile", "KITCHEN_YAML"=>"/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.kitchen.docker.yml"}
                        returns 0
                        declared_type :execute
                        cookbook_name "acceptance-cookbook"
                      end

                      Platform:
                      ---------
                      x86_64-linux


                    ================================================================================
                    Error executing action `run` on resource 'cookbook_kitchen[converge docker]'
                    ================================================================================

                    Mixlib::ShellOut::ShellCommandFailed
                    ------------------------------------
                    execute[bundle exec kitchen converge  -c] (/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/cookbooks/kitchen_acceptance/libraries/kitchen.rb line 36) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '10'
                    ---- Begin output of bundle exec kitchen converge  -c ----
                    STDOUT: -----> Starting Kitchen (v1.7.2)
                    -----> Creating <docker-default-ubuntu-1404>...
                           If you are not using an account that qualifies under the AWS
                    free-tier, you may be charged to run these suites. The charge
                    should be minimal, but neither Test Kitchen nor its maintainers
                    are responsible for your incurred costs.

                           Instance <i-54444b93> requested.
                           Polling AWS for existence, attempt 0...
                           Attempting to tag the instance, 0 retries
                           EC2 instance <i-54444b93> created.
                           Waited 0/300s for instance <i-54444b93> to become ready.
                           Waited 5/300s for instance <i-54444b93> to become ready.
                           Waited 10/300s for instance <i-54444b93> to become ready.
                           Waited 15/300s for instance <i-54444b93> to become ready.
                           Waited 20/300s for instance <i-54444b93> to become ready.
                           Waited 25/300s for instance <i-54444b93> to become ready.
                           EC2 instance <i-54444b93> ready.
                           Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                           Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                           Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                           Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                           Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                           [SSH] Established
                           Finished creating <docker-default-ubuntu-1404> (1m16.61s).
                    -----> Converging <docker-default-ubuntu-1404>...
                           Preparing files for transfer
                           Preparing dna.json
                           Resolving cookbook dependencies with Berkshelf 4.3.2...
                           Removing non-cookbook files before transfer
                           Preparing validation.pem
                           Preparing client.rb
                           ubuntu 14.04 x86_64
                           downloading http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb.metadata.json
                           http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb
                             to file /tmp/install.sh.1355/chefdk_0.13.19-1_amd64.deb
                           trying wget...
                           trying curl...
                           /tmp/chef-installer.sh: line 140: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                           grep: /tmp/install.sh.1355/stderr: No such file or directory
                           trying perl...
                           /tmp/chef-installer.sh: line 170: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                           grep: /tmp/install.sh.1355/stderr: No such file or directory
                           trying python...
                           /tmp/chef-installer.sh: line 191: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                           grep: /tmp/install.sh.1355/stderr: No such file or directory
                           Unable to retrieve a valid package!
                           Version: latest

                           Please file a Bug Report at https://github.com/chef/omnitruck/issues/new
                           Alternatively, feel free to open a Support Ticket at https://www.chef.io/support/tickets
                           More Chef support resources can be found at https://www.chef.io/support

                           Please include as many details about the problem as possible i.e., how to reproduce
                           the problem (if possible), type of the Operating System and its version, etc.,
                           and any other relevant details that might help us with troubleshooting.

                           Metadata URL:
                           Download URL: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb.metadata.json
                           http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb
                           \nDEBUG OUTPUT FOLLOWS:\n\nSTDERR from wget:\n\nhttp://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory\n
                    STDERR: >>>>>> Converge failed on instance <docker-default-ubuntu-1404>.
                    >>>>>> Please see .kitchen/logs/docker-default-ubuntu-1404.log for more details
                    >>>>>> ------Exception-------
                    >>>>>> Class: Kitchen::ActionFailed
                    >>>>>> Message: SSH exited (1) for command: [sudo -E cat > /tmp/chef-installer.sh <<"EOL"
                    #!/bin/bash
                    #!/bin/sh
                    # WARNING: REQUIRES /bin/sh
                    #
                    # - must run on /bin/sh on solaris 9
                    # - must run on /bin/sh on AIX 6.x
                    #
                    # Copyright:: Copyright (c) 2010-2015 Chef Software, Inc.
                    # License:: Apache License, Version 2.0
                    #
                    # Licensed under the Apache License, Version 2.0 (the "License");
                    # you may not use this file except in compliance with the License.
                    # You may obtain a copy of the License at
                    #
                    #     http://www.apache.org/licenses/LICENSE-2.0
                    #
                    # Unless required by applicable law or agreed to in writing, software
                    # distributed under the License is distributed on an "AS IS" BASIS,
                    # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                    # See the License for the specific language governing permissions and
                    # limitations under the License.
                    #

                    # helpers.sh
                    ############
                    # This section has some helper functions to make life easier.
                    #
                    # Outputs:
                    # $tmp_dir: secure-ish temp directory that can be used during installation.
                    ############

                    # Check whether a command exists - returns 0 if it does, 1 if it does not
                    exists() {
                      if command -v $1 >/dev/null 2>&1
                      then
                        return 0
                      else
                        return 1
                      fi
                    }

                    # Output the instructions to report bug about this script
                    report_bug() {
                      echo "Version: $version"
                      echo ""
                      echo "Please file a Bug Report at https://github.com/chef/omnitruck/issues/new"
                      echo "Alternatively, feel free to open a Support Ticket at https://www.chef.io/support/tickets"
                      echo "More Chef support resources can be found at https://www.chef.io/support"
                      echo ""
                      echo "Please include as many details about the problem as possible i.e., how to reproduce"
                      echo "the problem (if possible), type of the Operating System and its version, etc.,"
                      echo "and any other relevant details that might help us with troubleshooting."
                      echo ""
                    }

                    checksum_mismatch() {
                      echo "Package checksum mismatch!"
                      report_bug
                      exit 1
                    }

                    unable_to_retrieve_package() {
                      echo "Unable to retrieve a valid package!"
                      report_bug
                      echo "Metadata URL: $metadata_url"
                      if test "x$download_url" != "x"; then
                        echo "Download URL: $download_url"
                      fi
                      if test "x$stderr_results" != "x"; then
                        echo "\nDEBUG OUTPUT FOLLOWS:\n$stderr_results"
                      fi
                      exit 1
                    }

                    http_404_error() {
                      echo "Omnitruck artifact does not exist for version $version on platform $platform"
                      echo ""
                      echo "Either this means:"
                      echo "   - We do not support $platform"
                      echo "   - We do not have an artifact for $version"
                      echo ""
                      echo "This is often the latter case due to running a prerelease or RC version of chef"
                      echo "or a gem version which was only pushed to rubygems and not omnitruck."
                      echo ""
                      echo "You may be able to set your knife[:bootstrap_version] to the most recent stable"
                      echo "release of Chef to fix this problem (or the most recent stable major version number)."
                      echo ""
                      echo "In order to test the version parameter, adventurous users may take the Metadata URL"
                      echo "below and modify the '&v=<number>' parameter until you successfully get a URL that"
                      echo "does not 404 (e.g. via curl or wget).  You should be able to use '&v=11' or '&v=12'"
                      echo "succesfully."
                      echo ""
                      echo "If you cannot fix this problem by setting the bootstrap_version, it probably means"
                      echo "that $platform is not supported."
                      echo ""
                      # deliberately do not call report_bug to suppress bug report noise.
                      echo "Metadata URL: $metadata_url"
                      if test "x$download_url" != "x"; then
                        echo "Download URL: $download_url"
                      fi
                      if test "x$stderr_results" != "x"; then
                        echo "\nDEBUG OUTPUT FOLLOWS:\n$stderr_results"
                      fi
                      exit 1
                    }

                    capture_tmp_stderr() {
                      # spool up /tmp/stderr from all the commands we called
                      if test -f "$tmp_dir/stderr"; then
                        output=`cat $tmp_dir/stderr`
                        stderr_results="${stderr_results}\nSTDERR from $1:\n\n$output\n"
                        rm $tmp_dir/stderr
                      fi
                    }

                    # do_wget URL FILENAME
                    do_wget() {
                      echo "trying wget..."
                      wget -O "$2" "$1" 2>$tmp_dir/stderr
                      rc=$?
                      # check for 404
                      grep "ERROR 404" $tmp_dir/stderr 2>&1 >/dev/null
                      if test $? -eq 0; then
                        echo "ERROR 404"
                        http_404_error
                      fi

                      # check for bad return status or empty output
                      if test $rc -ne 0 || test ! -s "$2"; then
                        capture_tmp_stderr "wget"
                        return 1
                      fi

                      return 0
                    }

                    # do_curl URL FILENAME
                    do_curl() {
                      echo "trying curl..."
                      curl --retry 5 -sL -D $tmp_dir/stderr "$1" > "$2"
                      rc=$?
                      # check for 404
                      grep "404 Not Found" $tmp_dir/stderr 2>&1 >/dev/null
                      if test $? -eq 0; then
                        echo "ERROR 404"
                        http_404_error
                      fi

                      # check for bad return status or empty output
                      if test $rc -ne 0 || test ! -s "$2"; then
                        capture_tmp_stderr "curl"
                        return 1
                      fi

                      return 0
                    }

                    # do_fetch URL FILENAME
                    do_fetch() {
                      echo "trying fetch..."
                      fetch -o "$2" "$1" 2>$tmp_dir/stderr
                      # check for bad return status
                      test $? -ne 0 && return 1
                      return 0
                    }

                    # do_perl URL FILENAME
                    do_perl() {
                      echo "trying perl..."
                      perl -e 'use LWP::Simple; getprint($ARGV[0]);' "$1" > "$2" 2>$tmp_dir/stderr
                      rc=$?
                      # check for 404
                      grep "404 Not Found" $tmp_dir/stderr 2>&1 >/dev/null
                      if test $? -eq 0; then
                        echo "ERROR 404"
                        http_404_error
                      fi

                      # check for bad return status or empty output
                      if test $rc -ne 0 || test ! -s "$2"; then
                        capture_tmp_stderr "perl"
                        return 1
                      fi

                      return 0
                    }

                    # do_python URL FILENAME
                    do_python() {
                      echo "trying python..."
                      python -c "import sys,urllib2 ; sys.stdout.write(urllib2.urlopen(sys.argv[1]).read())" "$1" > "$2" 2>$tmp_dir/stderr
                      rc=$?
                      # check for 404
                      grep "HTTP Error 404" $tmp_dir/stderr 2>&1 >/dev/null
                      if test $? -eq 0; then
                        echo "ERROR 404"
                        http_404_error
                      fi

                      # check for bad return status or empty output
                      if test $rc -ne 0 || test ! -s "$2"; then
                        capture_tmp_stderr "python"
                        return 1
                      fi
                      return 0
                    }

                    # returns 0 if checksums match
                    do_checksum() {
                      if exists sha256sum; then
                        echo "Comparing checksum with sha256sum..."
                        checksum=`sha256sum $1 | awk '{ print $1 }'`
                        return `test "x$checksum" = "x$2"`
                      elif exists shasum; then
                        echo "Comparing checksum with shasum..."
                        checksum=`shasum -a 256 $1 | awk '{ print $1 }'`
                        return `test "x$checksum" = "x$2"`
                      else
                        echo "WARNING: could not find a valid checksum program, pre-install shasum or sha256sum in your O/S image to get valdation..."
                        return 0
                      fi
                    }

                    # do_download URL FILENAME
                    do_download() {
                      echo "downloading $1"
                      echo "  to file $2"

                      url=`echo $1`
                      if test "x$platform" = "xsolaris2"; then
                        if test "x$platform_version" = "x5.9" -o "x$platform_version" = "x5.10"; then
                          # solaris 9 lacks openssl, solaris 10 lacks recent enough credentials - your base O/S is completely insecure, please upgrade
                          url=`echo $url | sed -e 's/https/http/'`
                        fi
                      fi

                      # we try all of these until we get success.
                      # perl, in particular may be present but LWP::Simple may not be installed

                      if exists wget; then
                        do_wget $url $2 && return 0
                      fi

                      if exists curl; then
                        do_curl $url $2 && return 0
                      fi

                      if exists fetch; then
                        do_fetch $url $2 && return 0
                      fi

                      if exists perl; then
                        do_perl $url $2 && return 0
                      fi

                      if exists python; then
                        do_python $url $2 && return 0
                      fi

                      unable_to_retrieve_package
                    }

                    # install_file TYPE FILENAME
                    # TYPE is "rpm", "deb", "solaris", "sh", etc.
                    install_file() {
                      echo "Installing $project $version"
                      case "$1" in
                        "rpm")
                          if test "x$platform" = "xnexus" || test "x$platform" = "xios_xr"; then
                            echo "installing with yum..."
                            yum install -yv "$2"
                          else
                            echo "installing with rpm..."
                            rpm -Uvh --oldpackage --replacepkgs "$2"
                          fi
                          ;;
                        "deb")
                          echo "installing with dpkg..."
                          dpkg -i "$2"
                          ;;
                        "bff")
                          echo "installing with installp..."
                          installp -aXYgd "$2" all
                          ;;
                        "solaris")
                          echo "installing with pkgadd..."
                          echo "conflict=nocheck" > $tmp_dir/nocheck
                          echo "action=nocheck" >> $tmp_dir/nocheck
                          echo "mail=" >> $tmp_dir/nocheck
                          pkgrm -a $tmp_dir/nocheck -n $project >/dev/null 2>&1 || true
                          pkgadd -G -n -d "$2" -a $tmp_dir/nocheck $project
                          ;;
                        "pkg")
                          echo "installing with installer..."
                          cd / && /usr/sbin/installer -pkg "$2" -target /
                          ;;
                        "dmg")
                          echo "installing dmg file..."
                          hdiutil detach "/Volumes/chef_software" >/dev/null 2>&1 || true
                          hdiutil attach "$2" -mountpoint "/Volumes/chef_software"
                          cd / && /usr/sbin/installer -pkg `find "/Volumes/chef_software" -name \*.pkg` -target /
                          hdiutil detach "/Volumes/chef_software"
                          ;;
                        "sh" )
                          echo "installing with sh..."
                          sh "$2"
                          ;;
                        *)
                          echo "Unknown filetype: $1"
                          report_bug
                          exit 1
                          ;;
                      esac
                      if test $? -ne 0; then
                        echo "Installation failed"
                        report_bug
                        exit 1
                      fi
                    }

                    if test "x$TMPDIR" = "x"; then
                      tmp="/tmp"
                    else
                      tmp=$TMPDIR
                    fi
                    # secure-ish temp dir creation without having mktemp available (DDoS-able but not expliotable)
                    tmp_dir="$tmp/install.sh.$$"
                    (umask 077 && mkdir $tmp_dir) || exit 1

                    ############
                    # end of helpers.sh
                    ############


                    project=chefdk
                    version=latest
                    channel=unstable


                    # platform_detection.sh
                    ############
                    # This section makes platform detection compatible with omnitruck on the system
                    #   it runs.
                    #
                    # Outputs:
                    # $platform: Name of the platform.
                    # $platform_version: Version of the platform.
                    # $machine: System's architecture.
                    ############

                    #
                    # Platform and Platform Version detection
                    #
                    # NOTE: This should now match ohai platform and platform_version matching.
                    # do not invented new platform and platform_version schemas, just make this behave
                    # like what ohai returns as platform and platform_version for the server.
                    #
                    # ALSO NOTE: Do not mangle platform or platform_version here.  It is less error
                    # prone and more future-proof to do that in the server, and then all omnitruck clients
                    # will 'inherit' the changes (install.sh is not the only client of the omnitruck
                    # endpoint out there).
                    #

                    machine=`uname -m`
                    os=`uname -s`

                    if test -f "/etc/lsb-release" && grep -q DISTRIB_ID /etc/lsb-release && ! grep -q wrlinux /etc/lsb-release; then
                      platform=`grep DISTRIB_ID /etc/lsb-release | cut -d "=" -f 2 | tr '[A-Z]' '[a-z]'`
                      platform_version=`grep DISTRIB_RELEASE /etc/lsb-release | cut -d "=" -f 2`
                    elif test -f "/etc/debian_version"; then
                      platform="debian"
                      platform_version=`cat /etc/debian_version`
                    elif test -f "/etc/redhat-release"; then
                      platform=`sed 's/^\(.\+\) release.*/\1/' /etc/redhat-release | tr '[A-Z]' '[a-z]'`
                      platform_version=`sed 's/^.\+ release \([.0-9]\+\).*/\1/' /etc/redhat-release`

                      # If /etc/redhat-release exists, we act like RHEL by default
                      if test "$platform" = "fedora"; then
                        # FIXME: stop remapping fedora to el
                        # FIXME: remove client side platform_version mangling and hard coded yolo
                        # Change platform version for use below.
                        platform_version="6.0"
                      fi

                      if test "$platform" = "xenserver"; then
                        # Current XenServer 6.2 is based on CentOS 5, platform is not reset to "el" server should hanlde response
                        platform="xenserver"
                      else
                        # FIXME: use "redhat"
                        platform="el"
                      fi

                    elif test -f "/etc/system-release"; then
                      platform=`sed 's/^\(.\+\) release.\+/\1/' /etc/system-release | tr '[A-Z]' '[a-z]'`
                      platform_version=`sed 's/^.\+ release \([.0-9]\+\).*/\1/' /etc/system-release | tr '[A-Z]' '[a-z]'`
                      # amazon is built off of fedora, so act like RHEL
                      if test "$platform" = "amazon linux ami"; then
                        # FIXME: remove client side platform_version mangling and hard coded yolo, and remapping to deprecated "el"
                        platform="el"
                        platform_version="6.0"
                      fi
                    # Apple OS X
                    elif test -f "/usr/bin/sw_vers"; then
                      platform="mac_os_x"
                      # Matching the tab-space with sed is error-prone
                      platform_version=`sw_vers | awk '/^ProductVersion:/ { print $2 }' | cut -d. -f1,2`

                      # x86_64 Apple hardware often runs 32-bit kernels (see OHAI-63)
                      x86_64=`sysctl -n hw.optional.x86_64`
                      if test $x86_64 -eq 1; then
                        machine="x86_64"
                      fi
                    elif test -f "/etc/release"; then
                      machine=`/usr/bin/uname -p`
                      if grep -q SmartOS /etc/release; then
                        platform="smartos"
                        platform_version=`grep ^Image /etc/product | awk '{ print $3 }'`
                      else
                        platform="solaris2"
                        platform_version=`/usr/bin/uname -r`
                      fi
                    elif test -f "/etc/SuSE-release"; then
                      if grep -q 'Enterprise' /etc/SuSE-release;
                      then
                          platform="sles"
                          platform_version=`awk '/^VERSION/ {V = $3}; /^PATCHLEVEL/ {P = $3}; END {print V "." P}' /etc/SuSE-release`
                      else
                          platform="suse"
                          platform_version=`awk '/^VERSION =/ { print $3 }' /etc/SuSE-release`
                      fi
                    elif test "x$os" = "xFreeBSD"; then
                      platform="freebsd"
                      platform_version=`uname -r | sed 's/-.*//'`
                    elif test "x$os" = "xAIX"; then
                      platform="aix"
                      platform_version="`uname -v`.`uname -r`"
                      machine="powerpc"
                    elif test -f "/etc/os-release"; then
                      . /etc/os-release
                      if test "x$CISCO_RELEASE_INFO" != "x"; then
                        . $CISCO_RELEASE_INFO
                      fi

                      platform=$ID
                      platform_version=$VERSION
                    fi

                    if test "x$platform" = "x"; then
                      echo "Unable to determine platform version!"
                      report_bug
                      exit 1
                    fi

                    #
                    # NOTE: platform manging in the install.sh is DEPRECATED
                    #
                    # - install.sh should be true to ohai and should not remap
                    #   platform or platform versions.
                    #
                    # - remapping platform and mangling platform version numbers is
                    #   now the complete responsibility of the server-side endpoints
                    #

                    major_version=`echo $platform_version | cut -d. -f1`
                    case $platform in
                      # FIXME: should remove this case statement completely
                      "el")
                        # FIXME:  "el" is deprecated, should use "redhat"
                        platform_version=$major_version
                        ;;
                      "debian")
                        # FIXME: remove client-side yolo here
                        case $major_version in
                          "5") platform_version="6";;  # FIXME: need to port this "reverse-yolo" into platform.rb
                          "6") platform_version="6";;
                          "7") platform_version="6";;
                        esac
                        ;;
                      "freebsd")
                        platform_version=$major_version
                        ;;
                      "sles")
                        platform_version=$major_version
                        ;;
                      "suse")
                        platform_version=$major_version
                        ;;
                    esac

                    if test "x$platform_version" = "x"; then
                      echo "Unable to determine platform version!"
                      report_bug
                      exit 1
                    fi

                    if test "x$platform" = "xsolaris2"; then
                      # hack up the path on Solaris to find wget, pkgadd
                      PATH=/usr/sfw/bin:/usr/sbin:$PATH
                      export PATH
                    fi

                    echo "$platform $platform_version $machine"

                    ############
                    # end of platform_detection.sh
                    ############


                    # artifactory_urls.sh
                    ############
                    # This section sets up the information for a build to be installed from artifactory
                    #  then uses $platform, $platform_version and $machine to select the correct
                    #  version.
                    #
                    # Inputs:
                    # $platform:
                    # $platform_version:
                    # $machine:
                    #
                    # Outputs:
                    # $download_url:
                    # $sha256:
                    ############


                      artifact_info_dir="$tmp_dir/artifact_info/ubuntu/14.04/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 " >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.9/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.9/chefdk-0.13.19-1.dmg.metadata.json" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 " >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/debian/8/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/8/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 " >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/windows/2012r2/i386"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2012r2/chefdk-0.13.19-1-x86.msi" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 e82aaeb0ccefd32ae049e8b32045cc6d2acce75f7e4ae68e6e96bf198cb937b7" >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.11/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.11/chefdk-0.13.19-1.dmg.metadata.json" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 " >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/debian/6/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/6/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 bb5d254b05d1a536f58ef69e64e581dc113bdb32275c6104553a1782182c2cdb" >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/windows/2008r2/i386"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2008r2/chefdk-0.13.19-1-x86.msi.metadata.json" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 " >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/debian/6/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/6/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 " >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.9/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.9/chefdk-0.13.19-1.dmg" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 dfd9d05caab653a92717263fef698b83e14046f2d92cd627fd3725f10009062b" >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/windows/2012r2/i386"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2012r2/chefdk-0.13.19-1-x86.msi.metadata.json" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 " >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/windows/2012/i386"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2012/chefdk-0.13.19-1-x86.msi" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 e82aaeb0ccefd32ae049e8b32045cc6d2acce75f7e4ae68e6e96bf198cb937b7" >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/windows/2008r2/i386"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2008r2/chefdk-0.13.19-1-x86.msi" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 e82aaeb0ccefd32ae049e8b32045cc6d2acce75f7e4ae68e6e96bf198cb937b7" >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/debian/7/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/7/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 bb5d254b05d1a536f58ef69e64e581dc113bdb32275c6104553a1782182c2cdb" >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/el/7/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/el/7/chefdk-0.13.19-1.el7.x86_64.rpm" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 95cedf524c58cdb37421867aa6133a9774080136b5f35ea68d2822b6db9fdbfc" >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/windows/2012/i386"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2012/chefdk-0.13.19-1-x86.msi.metadata.json" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 " >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/debian/7/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/7/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 " >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/ubuntu/12.04/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/12.04/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 " >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/debian/8/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/8/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 bb5d254b05d1a536f58ef69e64e581dc113bdb32275c6104553a1782182c2cdb" >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/el/6/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/el/6/chefdk-0.13.19-1.el6.x86_64.rpm.metadata.json" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 " >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/ubuntu/12.04/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/12.04/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 530bca33b6b06f29b96056f79d024a8c58f9dee92e85f53bf5aa567b4f94a0f8" >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/el/6/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/el/6/chefdk-0.13.19-1.el6.x86_64.rpm" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 2aa10bc3f4948ea3788d8774a653ef048364841bb38b70f3eda6c8e64b27d152" >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/ubuntu/14.04/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 530bca33b6b06f29b96056f79d024a8c58f9dee92e85f53bf5aa567b4f94a0f8" >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.10/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.10/chefdk-0.13.19-1.dmg" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 dfd9d05caab653a92717263fef698b83e14046f2d92cd627fd3725f10009062b" >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/el/7/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/el/7/chefdk-0.13.19-1.el7.x86_64.rpm.metadata.json" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 " >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.11/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.11/chefdk-0.13.19-1.dmg" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 dfd9d05caab653a92717263fef698b83e14046f2d92cd627fd3725f10009062b" >> "$artifact_info_dir/artifact_info"

                      artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.10/x86_64"
                      mkdir -p $artifact_info_dir
                      touch "$artifact_info_dir/artifact_info"
                      echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.10/chefdk-0.13.19-1.dmg.metadata.json" >> "$artifact_info_dir/artifact_info"
                      echo "sha256 " >> "$artifact_info_dir/artifact_info"


                    artifact_info_for_platform="$tmp_dir/artifact_info/$platform/$platform_version/$machine/artifact_info"

                    download_url=`awk '$1 == "url" { print $2 }' "$artifact_info_for_platform"`
                    sha256=`awk '$1 == "sha256" { print $2 }' "$artifact_info_for_platform"`


                    # fetch_package.sh
                    ############
                    # This section fetchs a package from $download_url and verifies its metadata.
                    #
                    # Inputs:
                    # $download_url:
                    # $tmp_dir:
                    # Optional Inputs:
                    # $cmdline_filename: Name of the package downloaded on local disk.
                    # $cmdline_dl_dir: Name of the directory downloaded package will be saved to on local disk.
                    #
                    # Outputs:
                    # $download_filename: Name of the downloaded file on local disk.
                    # $filetype: Type of the file downloaded.
                    ############

                    filename=`echo $download_url | sed -e 's/^.*\///'`
                    filetype=`echo $filename | sed -e 's/^.*\.//'`

                    # use either $tmp_dir, the provided directory (-d) or the provided filename (-f)
                    if test "x$cmdline_filename" != "x"; then
                      download_filename="$cmdline_filename"
                    elif test "x$cmdline_dl_dir" != "x"; then
                      download_filename="$cmdline_dl_dir/$filename"
                    else
                      download_filename="$tmp_dir/$filename"
                    fi

                    # ensure the parent directory where to download the installer always exists
                    download_dir=`dirname $download_filename`
                    (umask 077 && mkdir -p $download_dir) || exit 1

                    # check if we have that file locally available and if so verify the checksum
                    cached_file_available="false"
                    if test -f $download_filename; then
                      echo "$download_filename already exists, verifiying checksum..."
                      if do_checksum "$download_filename" "$sha256"; then
                        echo "checksum compare succeeded, using existing file!"
                        cached_file_available="true"
                      else
                        echo "checksum mismatch, downloading latest version of the file"
                      fi
                    fi

                    # download if no local version of the file available
                    if test "x$cached_file_available" != "xtrue"; then
                      do_download "$download_url"  "$download_filename"
                      do_checksum "$download_filename" "$sha256" || checksum_mismatch
                    fi

                    ############
                    # end of fetch_package.sh
                    ############


                    # install_package.sh
                    ############
                    # Installs a package and removed the temp directory.
                    #
                    # Inputs:
                    # $download_filename: Name of the file to be installed.
                    # $filetype: Type of the file to be installed.
                    # $version: The version requested. Used only for warning user if not set.
                    ############

                    if test "x$version" = "x"; then
                      echo
                      echo "WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING"
                      echo
                      echo "You are installing an omnibus package without a version pin.  If you are installing"
                      echo "on production servers via an automated process this is DANGEROUS and you will"
                      echo "be upgraded without warning on new releases, even to new major releases."
                      echo "Letting the version float is only appropriate in desktop, test, development or"
                      echo "CI/CD environments."
                      echo
                      echo "WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING"
                      echo
                    fi

                    install_file $filetype "$download_filename"

                    if test "x$tmp_dir" != "x"; then
                      rm -r "$tmp_dir"
                    fi

                    ############
                    # end of install_package.sh
                    ############

                    EOL
                    chmod +x /tmp/chef-installer.sh
                    sudo -E /tmp/chef-installer.sh]
                    >>>>>> ----------------------
                    zlib(finalizer): the stream was freed prematurely.
                    ---- End output of bundle exec kitchen converge  -c ----
                    Ran bundle exec kitchen converge  -c returned 10

                    Resource Declaration:
                    ---------------------
                    # In /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/cookbooks/acceptance-cookbook/libraries/top_cookbooks.rb

                      7:     cookbook_kitchen "#{command} docker" do
                      8:     end
                      9:

                    Compiled Resource:
                    ------------------
                    # Declared in /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/cookbooks/acceptance-cookbook/libraries/top_cookbooks.rb:7:in `block in <class:TopCookbooks>'

                    cookbook_kitchen("converge docker") do
                      action [:run]
                      updated true
                      updated_by_last_action true
                      retries 0
                      retry_delay 2
                      default_guard_interpreter :default
                      declared_type :cookbook_kitchen
                      cookbook_name "acceptance-cookbook"
                      repository "https://github.com/chef-cookbooks/docker.git"
                      test_cookbook "docker"
                      repository_root "/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/test_run/docker"
                      branch "master"
                      command "converge"
                      kitchen_options "-c"
                      kitchen_dir "/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/test_run/docker/"
                      chef_channel "unstable"
                      chef_version "latest"
                      env {"BUNDLE_GEMFILE"=>"/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/Gemfile", "KITCHEN_YAML"=>"/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.kitchen.docker.yml"}
                    end

                    Platform:
                    ---------
                    x86_64-linux


                  ================================================================================
                  Error executing action `run` on resource 'top_cookbooks[converge]'
                  ================================================================================

                  Mixlib::ShellOut::ShellCommandFailed
                  ------------------------------------
                  cookbook_kitchen[converge docker] (/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/cookbooks/acceptance-cookbook/libraries/top_cookbooks.rb line 7) had an error: Mixlib::ShellOut::ShellCommandFailed: execute[bundle exec kitchen converge  -c] (/opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/cookbooks/kitchen_acceptance/libraries/kitchen.rb line 36) had an error: Mixlib::ShellOut::ShellCommandFailed: Expected process to exit with [0], but received '10'
                  ---- Begin output of bundle exec kitchen converge  -c ----
                  STDOUT: -----> Starting Kitchen (v1.7.2)
                  -----> Creating <docker-default-ubuntu-1404>...
                         If you are not using an account that qualifies under the AWS
                  free-tier, you may be charged to run these suites. The charge
                  should be minimal, but neither Test Kitchen nor its maintainers
                  are responsible for your incurred costs.

                         Instance <i-54444b93> requested.
                         Polling AWS for existence, attempt 0...
                         Attempting to tag the instance, 0 retries
                         EC2 instance <i-54444b93> created.
                         Waited 0/300s for instance <i-54444b93> to become ready.
                         Waited 5/300s for instance <i-54444b93> to become ready.
                         Waited 10/300s for instance <i-54444b93> to become ready.
                         Waited 15/300s for instance <i-54444b93> to become ready.
                         Waited 20/300s for instance <i-54444b93> to become ready.
                         Waited 25/300s for instance <i-54444b93> to become ready.
                         EC2 instance <i-54444b93> ready.
                         Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                         Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                         Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                         Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                         Waiting for SSH service on 10.194.9.98:22, retrying in 3 seconds
                         [SSH] Established
                         Finished creating <docker-default-ubuntu-1404> (1m16.61s).
                  -----> Converging <docker-default-ubuntu-1404>...
                         Preparing files for transfer
                         Preparing dna.json
                         Resolving cookbook dependencies with Berkshelf 4.3.2...
                         Removing non-cookbook files before transfer
                         Preparing validation.pem
                         Preparing client.rb
                         ubuntu 14.04 x86_64
                         downloading http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb.metadata.json
                         http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb
                           to file /tmp/install.sh.1355/chefdk_0.13.19-1_amd64.deb
                         trying wget...
                         trying curl...
                         /tmp/chef-installer.sh: line 140: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                         grep: /tmp/install.sh.1355/stderr: No such file or directory
                         trying perl...
                         /tmp/chef-installer.sh: line 170: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                         grep: /tmp/install.sh.1355/stderr: No such file or directory
                         trying python...
                         /tmp/chef-installer.sh: line 191: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory
                         grep: /tmp/install.sh.1355/stderr: No such file or directory
                         Unable to retrieve a valid package!
                         Version: latest

                         Please file a Bug Report at https://github.com/chef/omnitruck/issues/new
                         Alternatively, feel free to open a Support Ticket at https://www.chef.io/support/tickets
                         More Chef support resources can be found at https://www.chef.io/support

                         Please include as many details about the problem as possible i.e., how to reproduce
                         the problem (if possible), type of the Operating System and its version, etc.,
                         and any other relevant details that might help us with troubleshooting.

                         Metadata URL:
                         Download URL: http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb.metadata.json
                         http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb
                         \nDEBUG OUTPUT FOLLOWS:\n\nSTDERR from wget:\n\nhttp://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb: No such file or directory\n
                  STDERR: >>>>>> Converge failed on instance <docker-default-ubuntu-1404>.
                  >>>>>> Please see .kitchen/logs/docker-default-ubuntu-1404.log for more details
                  >>>>>> ------Exception-------
                  >>>>>> Class: Kitchen::ActionFailed
                  >>>>>> Message: SSH exited (1) for command: [sudo -E cat > /tmp/chef-installer.sh <<"EOL"
                  #!/bin/bash
                  #!/bin/sh
                  # WARNING: REQUIRES /bin/sh
                  #
                  # - must run on /bin/sh on solaris 9
                  # - must run on /bin/sh on AIX 6.x
                  #
                  # Copyright:: Copyright (c) 2010-2015 Chef Software, Inc.
                  # License:: Apache License, Version 2.0
                  #
                  # Licensed under the Apache License, Version 2.0 (the "License");
                  # you may not use this file except in compliance with the License.
                  # You may obtain a copy of the License at
                  #
                  #     http://www.apache.org/licenses/LICENSE-2.0
                  #
                  # Unless required by applicable law or agreed to in writing, software
                  # distributed under the License is distributed on an "AS IS" BASIS,
                  # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                  # See the License for the specific language governing permissions and
                  # limitations under the License.
                  #

                  # helpers.sh
                  ############
                  # This section has some helper functions to make life easier.
                  #
                  # Outputs:
                  # $tmp_dir: secure-ish temp directory that can be used during installation.
                  ############

                  # Check whether a command exists - returns 0 if it does, 1 if it does not
                  exists() {
                    if command -v $1 >/dev/null 2>&1
                    then
                      return 0
                    else
                      return 1
                    fi
                  }

                  # Output the instructions to report bug about this script
                  report_bug() {
                    echo "Version: $version"
                    echo ""
                    echo "Please file a Bug Report at https://github.com/chef/omnitruck/issues/new"
                    echo "Alternatively, feel free to open a Support Ticket at https://www.chef.io/support/tickets"
                    echo "More Chef support resources can be found at https://www.chef.io/support"
                    echo ""
                    echo "Please include as many details about the problem as possible i.e., how to reproduce"
                    echo "the problem (if possible), type of the Operating System and its version, etc.,"
                    echo "and any other relevant details that might help us with troubleshooting."
                    echo ""
                  }

                  checksum_mismatch() {
                    echo "Package checksum mismatch!"
                    report_bug
                    exit 1
                  }

                  unable_to_retrieve_package() {
                    echo "Unable to retrieve a valid package!"
                    report_bug
                    echo "Metadata URL: $metadata_url"
                    if test "x$download_url" != "x"; then
                      echo "Download URL: $download_url"
                    fi
                    if test "x$stderr_results" != "x"; then
                      echo "\nDEBUG OUTPUT FOLLOWS:\n$stderr_results"
                    fi
                    exit 1
                  }

                  http_404_error() {
                    echo "Omnitruck artifact does not exist for version $version on platform $platform"
                    echo ""
                    echo "Either this means:"
                    echo "   - We do not support $platform"
                    echo "   - We do not have an artifact for $version"
                    echo ""
                    echo "This is often the latter case due to running a prerelease or RC version of chef"
                    echo "or a gem version which was only pushed to rubygems and not omnitruck."
                    echo ""
                    echo "You may be able to set your knife[:bootstrap_version] to the most recent stable"
                    echo "release of Chef to fix this problem (or the most recent stable major version number)."
                    echo ""
                    echo "In order to test the version parameter, adventurous users may take the Metadata URL"
                    echo "below and modify the '&v=<number>' parameter until you successfully get a URL that"
                    echo "does not 404 (e.g. via curl or wget).  You should be able to use '&v=11' or '&v=12'"
                    echo "succesfully."
                    echo ""
                    echo "If you cannot fix this problem by setting the bootstrap_version, it probably means"
                    echo "that $platform is not supported."
                    echo ""
                    # deliberately do not call report_bug to suppress bug report noise.
                    echo "Metadata URL: $metadata_url"
                    if test "x$download_url" != "x"; then
                      echo "Download URL: $download_url"
                    fi
                    if test "x$stderr_results" != "x"; then
                      echo "\nDEBUG OUTPUT FOLLOWS:\n$stderr_results"
                    fi
                    exit 1
                  }

                  capture_tmp_stderr() {
                    # spool up /tmp/stderr from all the commands we called
                    if test -f "$tmp_dir/stderr"; then
                      output=`cat $tmp_dir/stderr`
                      stderr_results="${stderr_results}\nSTDERR from $1:\n\n$output\n"
                      rm $tmp_dir/stderr
                    fi
                  }

                  # do_wget URL FILENAME
                  do_wget() {
                    echo "trying wget..."
                    wget -O "$2" "$1" 2>$tmp_dir/stderr
                    rc=$?
                    # check for 404
                    grep "ERROR 404" $tmp_dir/stderr 2>&1 >/dev/null
                    if test $? -eq 0; then
                      echo "ERROR 404"
                      http_404_error
                    fi

                    # check for bad return status or empty output
                    if test $rc -ne 0 || test ! -s "$2"; then
                      capture_tmp_stderr "wget"
                      return 1
                    fi

                    return 0
                  }

                  # do_curl URL FILENAME
                  do_curl() {
                    echo "trying curl..."
                    curl --retry 5 -sL -D $tmp_dir/stderr "$1" > "$2"
                    rc=$?
                    # check for 404
                    grep "404 Not Found" $tmp_dir/stderr 2>&1 >/dev/null
                    if test $? -eq 0; then
                      echo "ERROR 404"
                      http_404_error
                    fi

                    # check for bad return status or empty output
                    if test $rc -ne 0 || test ! -s "$2"; then
                      capture_tmp_stderr "curl"
                      return 1
                    fi

                    return 0
                  }

                  # do_fetch URL FILENAME
                  do_fetch() {
                    echo "trying fetch..."
                    fetch -o "$2" "$1" 2>$tmp_dir/stderr
                    # check for bad return status
                    test $? -ne 0 && return 1
                    return 0
                  }

                  # do_perl URL FILENAME
                  do_perl() {
                    echo "trying perl..."
                    perl -e 'use LWP::Simple; getprint($ARGV[0]);' "$1" > "$2" 2>$tmp_dir/stderr
                    rc=$?
                    # check for 404
                    grep "404 Not Found" $tmp_dir/stderr 2>&1 >/dev/null
                    if test $? -eq 0; then
                      echo "ERROR 404"
                      http_404_error
                    fi

                    # check for bad return status or empty output
                    if test $rc -ne 0 || test ! -s "$2"; then
                      capture_tmp_stderr "perl"
                      return 1
                    fi

                    return 0
                  }

                  # do_python URL FILENAME
                  do_python() {
                    echo "trying python..."
                    python -c "import sys,urllib2 ; sys.stdout.write(urllib2.urlopen(sys.argv[1]).read())" "$1" > "$2" 2>$tmp_dir/stderr
                    rc=$?
                    # check for 404
                    grep "HTTP Error 404" $tmp_dir/stderr 2>&1 >/dev/null
                    if test $? -eq 0; then
                      echo "ERROR 404"
                      http_404_error
                    fi

                    # check for bad return status or empty output
                    if test $rc -ne 0 || test ! -s "$2"; then
                      capture_tmp_stderr "python"
                      return 1
                    fi
                    return 0
                  }

                  # returns 0 if checksums match
                  do_checksum() {
                    if exists sha256sum; then
                      echo "Comparing checksum with sha256sum..."
                      checksum=`sha256sum $1 | awk '{ print $1 }'`
                      return `test "x$checksum" = "x$2"`
                    elif exists shasum; then
                      echo "Comparing checksum with shasum..."
                      checksum=`shasum -a 256 $1 | awk '{ print $1 }'`
                      return `test "x$checksum" = "x$2"`
                    else
                      echo "WARNING: could not find a valid checksum program, pre-install shasum or sha256sum in your O/S image to get valdation..."
                      return 0
                    fi
                  }

                  # do_download URL FILENAME
                  do_download() {
                    echo "downloading $1"
                    echo "  to file $2"

                    url=`echo $1`
                    if test "x$platform" = "xsolaris2"; then
                      if test "x$platform_version" = "x5.9" -o "x$platform_version" = "x5.10"; then
                        # solaris 9 lacks openssl, solaris 10 lacks recent enough credentials - your base O/S is completely insecure, please upgrade
                        url=`echo $url | sed -e 's/https/http/'`
                      fi
                    fi

                    # we try all of these until we get success.
                    # perl, in particular may be present but LWP::Simple may not be installed

                    if exists wget; then
                      do_wget $url $2 && return 0
                    fi

                    if exists curl; then
                      do_curl $url $2 && return 0
                    fi

                    if exists fetch; then
                      do_fetch $url $2 && return 0
                    fi

                    if exists perl; then
                      do_perl $url $2 && return 0
                    fi

                    if exists python; then
                      do_python $url $2 && return 0
                    fi

                    unable_to_retrieve_package
                  }

                  # install_file TYPE FILENAME
                  # TYPE is "rpm", "deb", "solaris", "sh", etc.
                  install_file() {
                    echo "Installing $project $version"
                    case "$1" in
                      "rpm")
                        if test "x$platform" = "xnexus" || test "x$platform" = "xios_xr"; then
                          echo "installing with yum..."
                          yum install -yv "$2"
                        else
                          echo "installing with rpm..."
                          rpm -Uvh --oldpackage --replacepkgs "$2"
                        fi
                        ;;
                      "deb")
                        echo "installing with dpkg..."
                        dpkg -i "$2"
                        ;;
                      "bff")
                        echo "installing with installp..."
                        installp -aXYgd "$2" all
                        ;;
                      "solaris")
                        echo "installing with pkgadd..."
                        echo "conflict=nocheck" > $tmp_dir/nocheck
                        echo "action=nocheck" >> $tmp_dir/nocheck
                        echo "mail=" >> $tmp_dir/nocheck
                        pkgrm -a $tmp_dir/nocheck -n $project >/dev/null 2>&1 || true
                        pkgadd -G -n -d "$2" -a $tmp_dir/nocheck $project
                        ;;
                      "pkg")
                        echo "installing with installer..."
                        cd / && /usr/sbin/installer -pkg "$2" -target /
                        ;;
                      "dmg")
                        echo "installing dmg file..."
                        hdiutil detach "/Volumes/chef_software" >/dev/null 2>&1 || true
                        hdiutil attach "$2" -mountpoint "/Volumes/chef_software"
                        cd / && /usr/sbin/installer -pkg `find "/Volumes/chef_software" -name \*.pkg` -target /
                        hdiutil detach "/Volumes/chef_software"
                        ;;
                      "sh" )
                        echo "installing with sh..."
                        sh "$2"
                        ;;
                      *)
                        echo "Unknown filetype: $1"
                        report_bug
                        exit 1
                        ;;
                    esac
                    if test $? -ne 0; then
                      echo "Installation failed"
                      report_bug
                      exit 1
                    fi
                  }

                  if test "x$TMPDIR" = "x"; then
                    tmp="/tmp"
                  else
                    tmp=$TMPDIR
                  fi
                  # secure-ish temp dir creation without having mktemp available (DDoS-able but not expliotable)
                  tmp_dir="$tmp/install.sh.$$"
                  (umask 077 && mkdir $tmp_dir) || exit 1

                  ############
                  # end of helpers.sh
                  ############


                  project=chefdk
                  version=latest
                  channel=unstable


                  # platform_detection.sh
                  ############
                  # This section makes platform detection compatible with omnitruck on the system
                  #   it runs.
                  #
                  # Outputs:
                  # $platform: Name of the platform.
                  # $platform_version: Version of the platform.
                  # $machine: System's architecture.
                  ############

                  #
                  # Platform and Platform Version detection
                  #
                  # NOTE: This should now match ohai platform and platform_version matching.
                  # do not invented new platform and platform_version schemas, just make this behave
                  # like what ohai returns as platform and platform_version for the server.
                  #
                  # ALSO NOTE: Do not mangle platform or platform_version here.  It is less error
                  # prone and more future-proof to do that in the server, and then all omnitruck clients
                  # will 'inherit' the changes (install.sh is not the only client of the omnitruck
                  # endpoint out there).
                  #

                  machine=`uname -m`
                  os=`uname -s`

                  if test -f "/etc/lsb-release" && grep -q DISTRIB_ID /etc/lsb-release && ! grep -q wrlinux /etc/lsb-release; then
                    platform=`grep DISTRIB_ID /etc/lsb-release | cut -d "=" -f 2 | tr '[A-Z]' '[a-z]'`
                    platform_version=`grep DISTRIB_RELEASE /etc/lsb-release | cut -d "=" -f 2`
                  elif test -f "/etc/debian_version"; then
                    platform="debian"
                    platform_version=`cat /etc/debian_version`
                  elif test -f "/etc/redhat-release"; then
                    platform=`sed 's/^\(.\+\) release.*/\1/' /etc/redhat-release | tr '[A-Z]' '[a-z]'`
                    platform_version=`sed 's/^.\+ release \([.0-9]\+\).*/\1/' /etc/redhat-release`

                    # If /etc/redhat-release exists, we act like RHEL by default
                    if test "$platform" = "fedora"; then
                      # FIXME: stop remapping fedora to el
                      # FIXME: remove client side platform_version mangling and hard coded yolo
                      # Change platform version for use below.
                      platform_version="6.0"
                    fi

                    if test "$platform" = "xenserver"; then
                      # Current XenServer 6.2 is based on CentOS 5, platform is not reset to "el" server should hanlde response
                      platform="xenserver"
                    else
                      # FIXME: use "redhat"
                      platform="el"
                    fi

                  elif test -f "/etc/system-release"; then
                    platform=`sed 's/^\(.\+\) release.\+/\1/' /etc/system-release | tr '[A-Z]' '[a-z]'`
                    platform_version=`sed 's/^.\+ release \([.0-9]\+\).*/\1/' /etc/system-release | tr '[A-Z]' '[a-z]'`
                    # amazon is built off of fedora, so act like RHEL
                    if test "$platform" = "amazon linux ami"; then
                      # FIXME: remove client side platform_version mangling and hard coded yolo, and remapping to deprecated "el"
                      platform="el"
                      platform_version="6.0"
                    fi
                  # Apple OS X
                  elif test -f "/usr/bin/sw_vers"; then
                    platform="mac_os_x"
                    # Matching the tab-space with sed is error-prone
                    platform_version=`sw_vers | awk '/^ProductVersion:/ { print $2 }' | cut -d. -f1,2`

                    # x86_64 Apple hardware often runs 32-bit kernels (see OHAI-63)
                    x86_64=`sysctl -n hw.optional.x86_64`
                    if test $x86_64 -eq 1; then
                      machine="x86_64"
                    fi
                  elif test -f "/etc/release"; then
                    machine=`/usr/bin/uname -p`
                    if grep -q SmartOS /etc/release; then
                      platform="smartos"
                      platform_version=`grep ^Image /etc/product | awk '{ print $3 }'`
                    else
                      platform="solaris2"
                      platform_version=`/usr/bin/uname -r`
                    fi
                  elif test -f "/etc/SuSE-release"; then
                    if grep -q 'Enterprise' /etc/SuSE-release;
                    then
                        platform="sles"
                        platform_version=`awk '/^VERSION/ {V = $3}; /^PATCHLEVEL/ {P = $3}; END {print V "." P}' /etc/SuSE-release`
                    else
                        platform="suse"
                        platform_version=`awk '/^VERSION =/ { print $3 }' /etc/SuSE-release`
                    fi
                  elif test "x$os" = "xFreeBSD"; then
                    platform="freebsd"
                    platform_version=`uname -r | sed 's/-.*//'`
                  elif test "x$os" = "xAIX"; then
                    platform="aix"
                    platform_version="`uname -v`.`uname -r`"
                    machine="powerpc"
                  elif test -f "/etc/os-release"; then
                    . /etc/os-release
                    if test "x$CISCO_RELEASE_INFO" != "x"; then
                      . $CISCO_RELEASE_INFO
                    fi

                    platform=$ID
                    platform_version=$VERSION
                  fi

                  if test "x$platform" = "x"; then
                    echo "Unable to determine platform version!"
                    report_bug
                    exit 1
                  fi

                  #
                  # NOTE: platform manging in the install.sh is DEPRECATED
                  #
                  # - install.sh should be true to ohai and should not remap
                  #   platform or platform versions.
                  #
                  # - remapping platform and mangling platform version numbers is
                  #   now the complete responsibility of the server-side endpoints
                  #

                  major_version=`echo $platform_version | cut -d. -f1`
                  case $platform in
                    # FIXME: should remove this case statement completely
                    "el")
                      # FIXME:  "el" is deprecated, should use "redhat"
                      platform_version=$major_version
                      ;;
                    "debian")
                      # FIXME: remove client-side yolo here
                      case $major_version in
                        "5") platform_version="6";;  # FIXME: need to port this "reverse-yolo" into platform.rb
                        "6") platform_version="6";;
                        "7") platform_version="6";;
                      esac
                      ;;
                    "freebsd")
                      platform_version=$major_version
                      ;;
                    "sles")
                      platform_version=$major_version
                      ;;
                    "suse")
                      platform_version=$major_version
                      ;;
                  esac

                  if test "x$platform_version" = "x"; then
                    echo "Unable to determine platform version!"
                    report_bug
                    exit 1
                  fi

                  if test "x$platform" = "xsolaris2"; then
                    # hack up the path on Solaris to find wget, pkgadd
                    PATH=/usr/sfw/bin:/usr/sbin:$PATH
                    export PATH
                  fi

                  echo "$platform $platform_version $machine"

                  ############
                  # end of platform_detection.sh
                  ############


                  # artifactory_urls.sh
                  ############
                  # This section sets up the information for a build to be installed from artifactory
                  #  then uses $platform, $platform_version and $machine to select the correct
                  #  version.
                  #
                  # Inputs:
                  # $platform:
                  # $platform_version:
                  # $machine:
                  #
                  # Outputs:
                  # $download_url:
                  # $sha256:
                  ############


                    artifact_info_dir="$tmp_dir/artifact_info/ubuntu/14.04/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 " >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.9/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.9/chefdk-0.13.19-1.dmg.metadata.json" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 " >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/debian/8/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/8/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 " >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/windows/2012r2/i386"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2012r2/chefdk-0.13.19-1-x86.msi" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 e82aaeb0ccefd32ae049e8b32045cc6d2acce75f7e4ae68e6e96bf198cb937b7" >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.11/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.11/chefdk-0.13.19-1.dmg.metadata.json" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 " >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/debian/6/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/6/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 bb5d254b05d1a536f58ef69e64e581dc113bdb32275c6104553a1782182c2cdb" >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/windows/2008r2/i386"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2008r2/chefdk-0.13.19-1-x86.msi.metadata.json" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 " >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/debian/6/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/6/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 " >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.9/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.9/chefdk-0.13.19-1.dmg" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 dfd9d05caab653a92717263fef698b83e14046f2d92cd627fd3725f10009062b" >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/windows/2012r2/i386"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2012r2/chefdk-0.13.19-1-x86.msi.metadata.json" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 " >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/windows/2012/i386"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2012/chefdk-0.13.19-1-x86.msi" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 e82aaeb0ccefd32ae049e8b32045cc6d2acce75f7e4ae68e6e96bf198cb937b7" >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/windows/2008r2/i386"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2008r2/chefdk-0.13.19-1-x86.msi" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 e82aaeb0ccefd32ae049e8b32045cc6d2acce75f7e4ae68e6e96bf198cb937b7" >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/debian/7/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/7/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 bb5d254b05d1a536f58ef69e64e581dc113bdb32275c6104553a1782182c2cdb" >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/el/7/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/el/7/chefdk-0.13.19-1.el7.x86_64.rpm" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 95cedf524c58cdb37421867aa6133a9774080136b5f35ea68d2822b6db9fdbfc" >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/windows/2012/i386"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/windows/2012/chefdk-0.13.19-1-x86.msi.metadata.json" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 " >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/debian/7/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/7/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 " >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/ubuntu/12.04/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/12.04/chefdk_0.13.19-1_amd64.deb.metadata.json" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 " >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/debian/8/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/debian/8/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 bb5d254b05d1a536f58ef69e64e581dc113bdb32275c6104553a1782182c2cdb" >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/el/6/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/el/6/chefdk-0.13.19-1.el6.x86_64.rpm.metadata.json" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 " >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/ubuntu/12.04/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/12.04/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 530bca33b6b06f29b96056f79d024a8c58f9dee92e85f53bf5aa567b4f94a0f8" >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/el/6/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/el/6/chefdk-0.13.19-1.el6.x86_64.rpm" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 2aa10bc3f4948ea3788d8774a653ef048364841bb38b70f3eda6c8e64b27d152" >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/ubuntu/14.04/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/ubuntu/14.04/chefdk_0.13.19-1_amd64.deb" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 530bca33b6b06f29b96056f79d024a8c58f9dee92e85f53bf5aa567b4f94a0f8" >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.10/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.10/chefdk-0.13.19-1.dmg" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 dfd9d05caab653a92717263fef698b83e14046f2d92cd627fd3725f10009062b" >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/el/7/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/el/7/chefdk-0.13.19-1.el7.x86_64.rpm.metadata.json" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 " >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.11/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.11/chefdk-0.13.19-1.dmg" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 dfd9d05caab653a92717263fef698b83e14046f2d92cd627fd3725f10009062b" >> "$artifact_info_dir/artifact_info"

                    artifact_info_dir="$tmp_dir/artifact_info/mac_os_x/10.10/x86_64"
                    mkdir -p $artifact_info_dir
                    touch "$artifact_info_dir/artifact_info"
                    echo "url http://artifactory.chef.co/omnibus-unstable-local/com/getchef/chefdk/0.13.19/mac_os_x/10.10/chefdk-0.13.19-1.dmg.metadata.json" >> "$artifact_info_dir/artifact_info"
                    echo "sha256 " >> "$artifact_info_dir/artifact_info"


                  artifact_info_for_platform="$tmp_dir/artifact_info/$platform/$platform_version/$machine/artifact_info"

                  download_url=`awk '$1 == "url" { print $2 }' "$artifact_info_for_platform"`
                  sha256=`awk '$1 == "sha256" { print $2 }' "$artifact_info_for_platform"`


                  # fetch_package.sh
                  ############
                  # This section fetchs a package from $download_url and verifies its metadata.
                  #
                  # Inputs:
                  # $download_url:
                  # $tmp_dir:
                  # Optional Inputs:
                  # $cmdline_filename: Name of the package downloaded on local disk.
                  # $cmdline_dl_dir: Name of the directory downloaded package will be saved to on local disk.
                  #
                  # Outputs:
                  # $download_filename: Name of the downloaded file on local disk.
                  # $filetype: Type of the file downloaded.
                  ############

                  filename=`echo $download_url | sed -e 's/^.*\///'`
                  filetype=`echo $filename | sed -e 's/^.*\.//'`

                  # use either $tmp_dir, the provided directory (-d) or the provided filename (-f)
                  if test "x$cmdline_filename" != "x"; then
                    download_filename="$cmdline_filename"
                  elif test "x$cmdline_dl_dir" != "x"; then
                    download_filename="$cmdline_dl_dir/$filename"
                  else
                    download_filename="$tmp_dir/$filename"
                  fi

                  # ensure the parent directory where to download the installer always exists
                  download_dir=`dirname $download_filename`
                  (umask 077 && mkdir -p $download_dir) || exit 1

                  # check if we have that file locally available and if so verify the checksum
                  cached_file_available="false"
                  if test -f $download_filename; then
                    echo "$download_filename already exists, verifiying checksum..."
                    if do_checksum "$download_filename" "$sha256"; then
                      echo "checksum compare succeeded, using existing file!"
                      cached_file_available="true"
                    else
                      echo "checksum mismatch, downloading latest version of the file"
                    fi
                  fi

                  # download if no local version of the file available
                  if test "x$cached_file_available" != "xtrue"; then
                    do_download "$download_url"  "$download_filename"
                    do_checksum "$download_filename" "$sha256" || checksum_mismatch
                  fi

                  ############
                  # end of fetch_package.sh
                  ############


                  # install_package.sh
                  ############
                  # Installs a package and removed the temp directory.
                  #
                  # Inputs:
                  # $download_filename: Name of the file to be installed.
                  # $filetype: Type of the file to be installed.
                  # $version: The version requested. Used only for warning user if not set.
                  ############

                  if test "x$version" = "x"; then
                    echo
                    echo "WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING"
                    echo
                    echo "You are installing an omnibus package without a version pin.  If you are installing"
                    echo "on production servers via an automated process this is DANGEROUS and you will"
                    echo "be upgraded without warning on new releases, even to new major releases."
                    echo "Letting the version float is only appropriate in desktop, test, development or"
                    echo "CI/CD environments."
                    echo
                    echo "WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING"
                    echo
                  fi

                  install_file $filetype "$download_filename"

                  if test "x$tmp_dir" != "x"; then
                    rm -r "$tmp_dir"
                  fi

                  ############
                  # end of install_package.sh
                  ############

                  EOL
                  chmod +x /tmp/chef-installer.sh
                  sudo -E /tmp/chef-installer.sh]
                  >>>>>> ----------------------
                  zlib(finalizer): the stream was freed prematurely.
                  ---- End output of bundle exec kitchen converge  -c ----
                  Ran bundle exec kitchen converge  -c returned 10

                  Resource Declaration:
                  ---------------------
                  # In /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/cookbooks/acceptance-cookbook/recipes/provision.rb

                    1: top_cookbooks "converge"

                  Compiled Resource:
                  ------------------
                  # Declared in /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/cookbooks/acceptance-cookbook/recipes/provision.rb:1:in `from_file'

                  top_cookbooks("converge") do
                    action [:run]
                    updated true
                    updated_by_last_action true
                    retries 0
                    retry_delay 2
                    default_guard_interpreter :default
                    declared_type :top_cookbooks
                    cookbook_name "acceptance-cookbook"
                    recipe_name "provision"
                    command "converge"
                  end

                  Platform:
                  ---------
                  x86_64-linux

              Starting audit phase
            7618: |2

              Running handlers:
              [2016-04-12T19:31:38+00:00] ERROR: Running exception handlers
              Running handlers complete
              [2016-04-12T19:31:38+00:00] ERROR: Exception handlers complete
              Chef Client failed. 2 resources updated in 01 minutes 40 seconds
              [2016-04-12T19:31:38+00:00] ERROR: Failed to post audit report to server. Saving report to /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/failed-audit-data.json
              [2016-04-12T19:31:38+00:00] FATAL: Stacktrace dumped to /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/local-mode-cache/cache/chef-stacktrace.out
              [2016-04-12T19:31:38+00:00] FATAL: Please provide the contents of the stacktrace.out file if you file a bug report
              [2016-04-12T19:31:38+00:00] ERROR: Found 1 errors, they are stored in the backtrace
              [2016-04-12T19:31:39+00:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process exited unsuccessfully (exit code 1)
              STDERR:
              ---- End output of chef-client -z -c /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/config.rb --force-formatter -j /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/dna.json -o acceptance-cookbook::provision --no-color ----
              Ran chef-client -z -c /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/.chef/config.rb --force-formatter -j /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/chef-12.9.38/acceptance/top-cookbooks/.acceptance/acceptance-cookbook/tmp/dna.json -o acceptance-cookbook::provision --no-color returned 1
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/mixlib-shellout-2.2.6/lib/mixlib/shellout.rb:289:in `invalid!'
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/mixlib-shellout-2.2.6/lib/mixlib/shellout.rb:276:in `error!'
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/bundler/gems/chef-acceptance-49458ec493db/lib/chef-acceptance/chef_runner.rb:40:in `block in run!'
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/bundler-1.11.2/lib/bundler.rb:219:in `block in with_clean_env'
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/bundler-1.11.2/lib/bundler.rb:199:in `with_original_env'
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/gems/bundler-1.11.2/lib/bundler.rb:205:in `with_clean_env'
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/bundler/gems/chef-acceptance-49458ec493db/lib/chef-acceptance/chef_runner.rb:35:in `run!'
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/bundler/gems/chef-acceptance-49458ec493db/lib/chef-acceptance/application.rb:144:in `run_command'
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/bundler/gems/chef-acceptance-49458ec493db/lib/chef-acceptance/application.rb:111:in `block in run_suite'
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/bundler/gems/chef-acceptance-49458ec493db/lib/chef-acceptance/application.rb:109:in `each'
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/bundler/gems/chef-acceptance-49458ec493db/lib/chef-acceptance/application.rb:109:in `run_suite'
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/bundler/gems/chef-acceptance-49458ec493db/lib/chef-acceptance/application.rb:75:in `block (2 levels) in start_worker'
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/bundler/gems/chef-acceptance-49458ec493db/lib/chef-acceptance/application.rb:73:in `loop'
              /opt/chefdk/embedded/lib/ruby/gems/2.1.0/bundler/gems/chef-acceptance-49458ec493db/lib/chef-acceptance/application.rb:73:in `block in start_worker'
              CHEF-ACCEPTANCE::[2016-04-12 19:31:39 +0000] --force-destroy specified so attempting to run the destroy recipe
              TOP-COOKBOOKS::DESTROY::[2016-04-12 19:31:39 +0000] Initialized [.acceptance_logs/top-cookbooks/destroy.log] logger...
            7865: |
              CHEF-ACCEPTANCE::[2016-04-12 19:32:30 +0000] | top-cookbooks | Total         | 00:02:35 | Y     |
              CHEF-ACCEPTANCE::[2016-04-12 19:32:30 +0000] | Run           | Total         | 00:02:35 | Y     |
              Build step 'Invoke XShell command' marked build as failure
              Archiving artifacts
              Recording fingerprints
        steps:
          total: 3m31s
          before (setup time): 55s
          CHEF-ACCEPTANCE:
            total: 2m35s
            TOP-COOKBOOKS::PROVISION: 1m44s
            TOP-COOKBOOKS::DESTROY: 51s
        chef_acceptance_timing:
        - top-cookbooks:
            provision: 1m35s
            force-destroy: 37s
            Total: 2m35s
          Run:
            Total: 2m35s
      windows-2008r2-i386:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-test/architecture=i386,platform=windows-2008r2,project=chefdk,role=tester/98/
        duration: 8m36s
      debian-6:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-test/architecture=x86_64,platform=debian-6,project=chefdk,role=tester/98/
        duration: 18m49s
      debian-7:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-test/architecture=x86_64,platform=debian-7,project=chefdk,role=tester/98/
        duration: 13m47s
      debian-8:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-test/architecture=x86_64,platform=debian-8,project=chefdk,role=tester/98/
        duration: 14m36s
      el-6:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-test/architecture=x86_64,platform=el-6,project=chefdk,role=tester/98/
        duration: 28m51s
      el-7:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-test/architecture=x86_64,platform=el-7,project=chefdk,role=tester/98/
        duration: 12m48s
      mac_os_x-10.10:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-test/architecture=x86_64,platform=mac_os_x-10.10,project=chefdk,role=tester/98/
        duration: 10m53s
      mac_os_x-10.11:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-test/architecture=x86_64,platform=mac_os_x-10.11,project=chefdk,role=tester/98/
        duration: 8m42s
      mac_os_x-10.9:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-test/architecture=x86_64,platform=mac_os_x-10.9,project=chefdk,role=tester/98/
        duration: 11m17s
      ubuntu-12.04:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-test/architecture=x86_64,platform=ubuntu-12.04,project=chefdk,role=tester/98/
        duration: 14m11s
      ubuntu-14.04:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-test/architecture=x86_64,platform=ubuntu-14.04,project=chefdk,role=tester/98/
        duration: 16m14s
  chefdk-build:
    result: SUCCESS
    url: http://manhattan.ci.chef.co/job/chefdk-build/238/
    duration: 28m38s
    runs:
      windows-2008r2-i386:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-build/architecture=i386,platform=windows-2008r2,project=chefdk,role=builder/238/
        duration: 28m25s
      debian-6:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-build/architecture=x86_64,platform=debian-6,project=chefdk,role=builder/238/
        duration: 24m50s
      el-6:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-build/architecture=x86_64,platform=el-6,project=chefdk,role=builder/238/
        duration: 28m1s
      el-7:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-build/architecture=x86_64,platform=el-7,project=chefdk,role=builder/238/
        duration: 22m25s
      mac_os_x-10.9:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-build/architecture=x86_64,platform=mac_os_x-10.9,project=chefdk,role=builder/238/
        duration: 11m18s
      ubuntu-12.04:
        result: SUCCESS
        url: http://manhattan.ci.chef.co/job/chefdk-build/architecture=x86_64,platform=ubuntu-12.04,project=chefdk,role=builder/238/
        duration: 23m17s
  chefdk-trigger-release:
    result: SUCCESS
    url: http://manhattan.ci.chef.co/job/chefdk-trigger-release/37/
    duration: 10s
